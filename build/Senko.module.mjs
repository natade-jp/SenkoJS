/*!
 * SenkoJS
 * https://github.com/natade-jp/SenkoJS
 * Copyright 2013-2019 natade
 *
 * The MIT license.
 * https://opensource.org/licenses/MIT
 */
class ArrayList{constructor(){if(this.element=[],1===arguments.length)for(let t=0;t<arguments[0].element.length;t++)this.element[t]=arguments[0].element[t]}each(t){let e=!0;for(let n=0;n<this.element.length;n++){const i=this.element[n];if(!1===t.call(i,n,i)){e=!1;break}}return e}toString(){return this.join(", ")}isEmpty(){return 0===this.element.length}contains(t){return this.element.contains(t)}size(){return this.element.length}clear(){this.element.length=0}join(t){return 0===arguments.length&&(t=","),this.element.join(t)}clone(){const t=new ArrayList;for(let e=0;e<this.element.length;e++)t.element[e]=this.element[e];return t}indexOf(t){for(let e=0;e<this.element.length;e++)if(this.element[e]===t)return e;return-1}lastIndexOf(t){for(let e=this.element.length-1;-1!==e;e--)if(this.element[e]===t)return e;return-1}get(t){return this.element[t]}add(){if(1===arguments.length){const t=arguments[0];this.element.push(t)}else if(2===arguments.length){const t=arguments[0],e=arguments[1];this.element.splice(t,0,e)}}addAll(){if(1===arguments.length){const t=arguments[0];let e=this.element.length;for(let n=0;n<t.length;n++)this.element[e++]=t.element[n]}else if(2===arguments.length){let t=arguments[0],e=arguments[1].element;e===this.element&&(e=this.element.slice(0));let n=this.element.length-t,i=this.element.length+e.length-1,o=this.element.length-1;for(let t=0;t<n;t++)this.element[i--]=this.element[o--];n=e.length;for(let i=0;i<n;i++)this.element[t++]=e[i]}}set(t,e){this.element[t]=e}remove(t){this.element.splice(t,1)}removeRange(t,e){this.element.splice(t,e-t)}sort(t){let e;e=0===arguments.length?ArrayList.COMPARE.DEFAULT:t;const n=[],i=function(t,e,o,s){if(e<o){const h=Math.floor((e+o)/2);i(t,e,h,s),i(t,h+1,o,s);let r,l,a,u=0;for(r=e;r<=h;r++)n[u++]=t[r];for(r=h+1,l=0,a=e;r<=o&&l<u;)s(t[r],n[l])>=0?t[a++]=n[l++]:t[a++]=t[r++];for(;l<u;)t[a++]=n[l++]}return!0};i(this.element,0,this.element.length-1,e)}}ArrayList.COMPARE={},ArrayList.COMPARE.DEFAULT=function(t,e){return t===e?0:typeof t==typeof e?t<e?-1:1:typeof t<typeof e?-1:1};class Color{constructor(){this.r=0,this.g=0,this.b=0,this.a=1}limit(){const t=new Color;return t.r=Color._limit(this.r),t.g=Color._limit(this.g),t.b=Color._limit(this.b),t.a=Color._limit(this.a),t}bake(){const t=new Color;return t.r=this.r*this.a,t.g=this.g*this.a,t.b=this.b*this.a,t.a=1,t.limit()}addColorMixture(t){if(!(t instanceof Color))throw"IllegalArgumentException";return Color.newColorNormalizedRGB(this.r+t.r*t.a,this.g+t.g*t.a,this.b+t.b*t.a,this.a)}subColorMixture(t){if(!(t instanceof Color))throw"IllegalArgumentException";const e=Math.min(this.r,t.r),n=Math.min(this.g,t.g),i=Math.min(this.b,t.b);return Color.newColorNormalizedRGB(Color._mix(this.r,e,t.a),Color._mix(this.g,n,t.a),Color._mix(this.b,i,t.a),this.a)}mul(t){if(t instanceof Color)return Color.newColorNormalizedRGB(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a);if("number"==typeof t||t instanceof Number)return Color.newColorNormalizedRGB(this.r*t,this.g*t,this.b*t,this.a);throw"IllegalArgumentException"}clone(){const t=new Color;return t.r=this.r,t.g=this.g,t.b=this.b,t.a=this.a,t}toString(){return"Color["+this.getCSSHex()+", "+this.getCSS255()+", "+this.getCSSPercent()+"]"}static _mix(t,e,n){return t+(e-t)*n}static _limit(t){return Math.max(Math.min(t,1),0)}static _flact(t){return t-Math.floor(t)}static _hex(t){return t=Math.round(255*t).toString(16),1===t.length?"0"+t:t}_setRGB(t,e,n,i){return this.r=t,this.g=e,this.b=n,i&&(this.a=i),this}_setHSV(t,e,n,i){let o,s;return this.r=n,this.g=n,this.b=n,i&&(this.a=i),e>0&&(s=(t*=6)-(o=~~Math.floor(t)),0===o?(this.g*=1-e*(1-s),this.b*=1-e):1===o?(this.r*=1-e*s,this.b*=1-e):2===o?(this.r*=1-e,this.b*=1-e*(1-s)):3===o?(this.r*=1-e,this.g*=1-e*s):4===o?(this.r*=1-e*(1-s),this.g*=1-e):5===o&&(this.g*=1-e,this.b*=1-e*s)),this}_setHSL(t,e,n,i){if(i&&(this.a=i),0===e)return this.r=0,this.g=0,this.b=0,this;let o;const s=2*n-(o=n<.5?n*(1+e):n*(1-e)+e),h=o-s;t*=6;const r=~~Math.floor(t),l=t-r;return 0===r?(this.r=o,this.g=o-h*(1-l),this.b=s):1===r?(this.r=s+h*(1-l),this.g=o,this.b=s):2===r?(this.r=s,this.g=o,this.b=o-h*(1-l)):3===r?(this.r=s,this.g=s+h*(1-l),this.b=o):4===r?(this.r=o-h*(1-l),this.g=s,this.b=o):5===r&&(this.r=o,this.g=s,this.b=s+h*(1-l)),this}_getRGB(){return{r:this.r,g:this.g,b:this.b,a:this.a}}_getHSV(){const t=Math.max(this.r,this.g,this.b),e=Math.min(this.r,this.g,this.b),n=t-e;let i=0,o=t-e;const s=t;return 0!==t&&(o/=t),0===n?[i,o,s]:(t===this.r?(i=(this.g-this.b)/n)<0&&(i+=6):i=t===this.g?2+(this.b-this.r)/n:4+(this.r-this.g)/n,i/=6,{h:i,s:o,v:s,a:this.a})}_getHSL(){const t=Math.max(this.r,this.g,this.b),e=Math.min(this.r,this.g,this.b),n=.5*(t+e),i=t-e;if(0===i)return[0,n,0];let o;o=n<.5?i/(t+e):i/(2-t-e);let s;return t===this.r?(s=(this.g-this.b)/i)<0&&(s+=6):s=t===this.g?2+(this.b-this.r)/i:4+(this.r-this.g)/i,s/=6,{h:s,s:o,l:n,a:this.a}}getNormalizedRGB(){return this._getRGB()}getRGB(){return{r:Math.round(255*this.r),g:Math.round(255*this.g),b:Math.round(255*this.b),a:Math.round(255*this.a)}}getRRGGBB(){return Math.round(255*Color._limit(this.r))<<16|Math.round(255*Color._limit(this.g))<<8|Math.round(255*Color._limit(this.b))}getAARRGGBB(){return Math.round(255*Color._limit(this.a))<<24|Math.round(255*Color._limit(this.r))<<16|Math.round(255*Color._limit(this.g))<<8|Math.round(255*Color._limit(this.b))}getNormalizedHSV(){return this._getHSV()}getHSV(){const t=this.getNormalizedHSV();return t.h=Math.round(360*t.h),t.s=Math.round(255*t.s),t.v=Math.round(255*t.v),t.a=Math.round(255*t.a),t}getNormalizedHSL(){return this._getHSL()}getHSL(){const t=this.getNormalizedHSL();return t.h=Math.round(360*t.h),t.s=Math.round(255*t.s),t.l=Math.round(255*t.l),t.a=Math.round(255*t.a),t}getRed(){return Math.round(255*this.r)}getGreen(){return Math.round(255*this.g)}getBlue(){return Math.round(255*this.b)}getAlpha(){return Math.round(255*this.b)}brighter(){return this.mul(1/.7).limit()}darker(){return this.mul(.7).limit()}getCSSHex(){return 1===this.a?"#"+Color._hex(Color._limit(this.r))+Color._hex(Color._limit(this.g))+Color._hex(Color._limit(this.b)):"#"+Color._hex(Color._limit(this.a))+Color._hex(Color._limit(this.r))+Color._hex(Color._limit(this.g))+Color._hex(Color._limit(this.b))}getCSS255(){return 1===this.a?"rgb("+Math.round(255*Color._limit(this.r))+","+Math.round(255*Color._limit(this.g))+","+Math.round(255*Color._limit(this.b))+")":"rgba("+Math.round(255*Color._limit(this.r))+","+Math.round(255*Color._limit(this.g))+","+Math.round(255*Color._limit(this.b))+","+this.a+")"}getCSSPercent(){return 1===this.a?"rgb("+Math.round(100*Color._limit(this.r))+"%,"+Math.round(100*Color._limit(this.g))+"%,"+Math.round(100*Color._limit(this.b))+"%)":"rgba("+Math.round(100*Color._limit(this.r))+"%,"+Math.round(100*Color._limit(this.g))+"%,"+Math.round(100*Color._limit(this.b))+"%,"+Math.round(100*Color._limit(this.a))+"%)"}setAlpha(t){const e=this.clone();return e.a=t,e}static newColorNormalizedRGB(){let t=0,e=0,n=0,i=1;1===arguments.length?(arguments[0].r&&(t=arguments[0].r),arguments[0].g&&(e=arguments[0].g),arguments[0].b&&(n=arguments[0].b),arguments[0].a&&(i=arguments[0].a),arguments[0].length>=3&&(t=arguments[0][0],e=arguments[0][1],n=arguments[0][2]),arguments[0].length>=4&&(i=arguments[0][3])):(arguments.length>=3&&(t=arguments[0],e=arguments[1],n=arguments[2]),arguments.length>=4&&(i=arguments[3]));const o=new Color;return o._setRGB(t,e,n,i),o}static newColorRGB(){let t=0,e=0,n=0,i=255;arguments.length>=3?(t=arguments[0],e=arguments[1],n=arguments[2],arguments.length>=4&&(i=arguments[3])):arguments.length>=1&&("number"==typeof arguments[0]?(t=arguments[0]>>16&255,e=arguments[0]>>8&255,n=255&arguments[0],arguments[1]&&(i=arguments[0]>>24&255)):void 0===arguments[0].length?(arguments[0].r&&(t=arguments[0].r),arguments[0].g&&(e=arguments[0].g),arguments[0].b&&(n=arguments[0].b),arguments[0].a&&(i=arguments[0].a)):arguments[0].length>=3&&(t=arguments[0][0],e=arguments[0][1],n=arguments[0][2],arguments[0].length>=4&&(i=arguments[0][3])));const o=new Color;return o._setRGB(t/255,e/255,n/255,i/255),o}static newColorNormalizedHSV(){let t=0,e=0,n=0,i=1;1===arguments.length?(arguments[0].h&&(t=arguments[0].h),arguments[0].s&&(e=arguments[0].s),arguments[0].v&&(n=arguments[0].v),arguments[0].a&&(i=arguments[0].a),arguments[0].length>=3&&(t=arguments[0][0],e=arguments[0][1],n=arguments[0][2]),arguments[0].length>=4&&(i=arguments[0][3])):(arguments.length>=3&&(t=arguments[0],e=arguments[1],n=arguments[2]),arguments.length>=4&&(i=arguments[3])),e=Color._limit(e),n=Color._limit(n);const o=new Color;return o._setHSV(Color._flact(t),e,n,i),o}static newColorHSV(){let t=0,e=0,n=0,i=255;return 1===arguments.length?(arguments[0].h&&(t=arguments[0].h),arguments[0].s&&(e=arguments[0].s),arguments[0].v&&(n=arguments[0].v),arguments[0].a&&(i=arguments[0].a),arguments[0].length>=3&&(t=arguments[0][0],e=arguments[0][1],n=arguments[0][2]),arguments[0].length>=4&&(i=arguments[0][3])):(arguments.length>=3&&(t=arguments[0],e=arguments[1],n=arguments[2]),arguments.length>=4&&(i=arguments[3])),Color.newColorNormalizedHSV(t/360,e/255,n/255,i/255)}static newColorNormalizedHSL(){let t=0,e=0,n=0,i=1;1===arguments.length?(arguments[0].h&&(t=arguments[0].h),arguments[0].s&&(e=arguments[0].s),arguments[0].l&&(n=arguments[0].l),arguments[0].a&&(i=arguments[0].a),arguments[0].length>=3&&(t=arguments[0][0],e=arguments[0][1],n=arguments[0][2]),arguments[0].length>=4&&(i=arguments[0][3])):(arguments.length>=3&&(t=arguments[0],e=arguments[1],n=arguments[2]),arguments.length>=4&&(i=arguments[3])),e=Color._limit(e),n=Color._limit(n);const o=new Color;return o._setHSL(Color._flact(t),e,n,i),o}static newColorHSL(){let t=0,e=0,n=0,i=255;return 1===arguments.length?(arguments[0].h&&(t=arguments[0].h),arguments[0].s&&(e=arguments[0].s),arguments[0].l&&(n=arguments[0].l),arguments[0].a&&(i=arguments[0].a),arguments[0].length>=3&&(t=arguments[0][0],e=arguments[0][1],n=arguments[0][2]),arguments[0].length>=4&&(i=arguments[0][3])):(arguments.length>=3&&(t=arguments[0],e=arguments[1],n=arguments[2]),arguments.length>=4&&(i=arguments[3])),Color.newColorNormalizedHSL(t/360,e/255,n/255,i/255)}}Color.white=Color.newColorRGB(16777215),Color.lightGray=Color.newColorRGB(13882323),Color.gray=Color.newColorRGB(8421504),Color.darkGray=Color.newColorRGB(11119017),Color.black=Color.newColorRGB(0),Color.red=Color.newColorRGB(16711680),Color.pink=Color.newColorRGB(16761035),Color.orange=Color.newColorRGB(16753920),Color.yellow=Color.newColorRGB(16776960),Color.green=Color.newColorRGB(32768),Color.magenta=Color.newColorRGB(16711935),Color.cyan=Color.newColorRGB(65535),Color.blue=Color.newColorRGB(255),Color.WHITE=Color.white,Color.LIGHT_GRAY=Color.lightGray,Color.GRAY=Color.gray,Color.DARK_GRAY=Color.darkGray,Color.RED=Color.red,Color.PINK=Color.pink,Color.ORANGE=Color.orange,Color.YELLOW=Color.yellow,Color.GREEN=Color.green,Color.MAGENTA=Color.magenta,Color.CYAN=Color.cyan,Color.BLUE=Color.blue;const CSVTool={parseCSV:function(t,e){arguments.length<2&&(e=","),t=t.replace(/\r\n?|\n/g,"\n");const n=e.charCodeAt(0),i=[],o=t.length;let s="",h=0,r=0,l=!1,a=!1;for(let e=0;e<o;e++){let u=t.charCodeAt(e);if(34===u&&0===s.length)for(e++;e<o;e++)if(34===(u=t.charCodeAt(e))){if(e+1===o-1)break;if(34!==t.charCodeAt(e+1))break;e++,s+='"'}else s+=t.charAt(e);else{switch(u){case n:l=!0;break;case 13:case 10:a=!0}l?(l=!1,void 0===i[h]&&(i[h]=[]),i[h][r]=s,s="",r+=1):a?(a=!1,""===s&&0===r||(void 0===i[h]&&(i[h]=[]),i[h][r]=s,s="",h+=1,r=0)):s+=t.charAt(e)}e===o-1&&0!==r&&(i[h][r]=s)}return i},makeCSV:function(t,e,n){arguments.length<2&&(e=","),arguments.length<3&&(n="\r\n");let i="";const o=/["\r\n,\t]/;if(void 0!==t)for(let s=0;s<t.length;s++){if(void 0!==t[s])for(let n=0;n<t[s].length;n++){let h=t[s][n];o.test(h)&&(h='"'+(h=h.replace(/"/g,'""'))+'"'),i+=h,n!==t[s].length-1&&(i+=e)}i+=n}return i}};class File$1{constructor(t){if(this.isHTML="undefined"!=typeof window,this.isNode=!1,1!==arguments.length)throw"IllegalArgumentException";if("string"==typeof t||t instanceof String)this.pathname=t.replace(/\\/g,"/");else{if(!(t instanceof File$1))throw"IllegalArgumentException";this.pathname=t.getAbsolutePath()}}delete_(){throw"IllegalMethod"}exists(){throw"IllegalMethod"}copy(){throw"IllegalMethod"}move(){throw"IllegalMethod"}toString(){return this.getAbsolutePath()}getName(){if(this.isHTML){if(this.isDirectory())return"";const t=this.pathname.split("/");return t[t.length-1]}if(this.isNode)throw"IllegalMethod"}getParent(){const t=this.getAbsolutePath().match(/.*[\/\\]/)[0];return t.substring(0,t.length-1)}getParentFile(){return new File$1(this.getParent())}getExtensionName(){if(this.isHTML){const t=this.getName().split(".");return t[t.length-1]}if(this.isNode)throw"IllegalMethod"}isAbsolute(){if(this.isHTML)return this.getAbsolutePath()===this.pathname;if(this.isNode)throw"IllegalMethod"}isDirectory(){if(this.isHTML)return/\/$/.test(this.pathname);if(this.isNode)throw"IllegalMethod"}isFile(){if(this.isHTML)return/[^\/]$/.test(this.pathname);if(this.isNode)throw"IllegalMethod"}isHidden(){if(this.isNode)throw"IllegalMethod"}lastModified(){if(this.isNode)throw"IllegalMethod"}setLastModified(){if(this.isNode)throw"IllegalMethod"}length(){if(this.isNode)throw"IllegalMethod"}getFiles(){if(this.isNode)throw"IllegalMethod"}getSubFolders(){if(this.isNode)throw"IllegalMethod"}getNormalizedPathName(){if(""===this.pathname)return".\\";let t=this.pathname.replace(/\//g,"\\");return"\\"!==t.slice(-1)&&(t+="\\"),t}getAllFiles(){if(this.isNode)throw"IllegalMethod"}list(){if(this.isNode)throw"IllegalMethod"}getAbsolutePath(){if(this.isHTML){let t=null;if(/^http/.test(this.pathname))t=this.pathname;else{let e=window.location.toString();/\/$/.test(e)||(e=e.match(/.*\//)[0]),t=e+this.pathname}const e=t.match(/^http[^\/]+\/\/[^\/]+\//)[0],n=t.substr(e.length);let i=e;const o=n.split("/");let s;for(s=0;s<o.length;s++)""!==o[s]&&"."!==o[s]&&(".."!==o[s]?(i+=o[s],s!==o.length-1&&(i+="/")):i=i.substring(0,i.length-1).match(/.*\//)[0]);return i}if(this.isNode)throw"IllegalMethod"}mkdir(){if(this.isNode)throw"IllegalMethod"}mkdirs(){if(this.isNode)throw"IllegalMethod"}renameTo(){if(this.isNode)throw"IllegalMethod"}run(){if(this.isNode)throw"IllegalMethod"}writeLine(){if(this.isNode)throw"IllegalMethod"}download(t){if(this.isHTML){const e=this.getExtensionName().toLocaleString(),n=this;if("gif"===e||"jpg"===e||"png"===e||"bmp"===e||"svg"===e||"jpeg"===e){const e=new Image;e.onload=function(){n.dataImage=e,t(n)},e.src=this.pathname}else{const e=File$1.createXMLHttpRequest();if(null===e)return null;const i=function(){if(4===e.readyState){if(200!==e.status)return console.log("error downloadText "+n.pathname),null;n.dataText=e.responseText,t(n)}};e.onreadystatechange=i,e.open("GET",this.pathname,!0),e.send(null)}}else if(this.isNode)throw"IllegalMethod"}getImage(){if(this.isHTML)return this.dataImage}getText(){if(this.isHTML)return this.dataText;if(this.isNode)throw"IllegalMethod"}setText(){if(this.isNode)throw"IllegalMethod"}getCSV(t,e,n){if(this.isHTML)return CSVTool.parseCSV(this.dataText,t,n);if(this.isNode)throw"IllegalMethod"}setCSV(){if(this.isNode)throw"IllegalMethod"}getByte(){if(this.isNode)throw"IllegalMethod"}setByte(){if(this.isNode)throw"IllegalMethod"}static createTempFile(){if("undefined"!=typeof window)throw"not createTempFile"}static getCurrentDirectory(){if("undefined"!=typeof window){const t=new File$1("./");return t.getParent()}}static setCurrentDirectory(){if("undefined"!=typeof window)throw"not setCurrentDirectory"}static searchFile(){if("undefined"!=typeof window)throw"not searchFile"}static downloadFileList(t,e,n){let i,o=0;for(i=0;i<t.length;i++)t[i].download(function(i){return function(){o++,n&&n.length&&n[i]&&n[i](t[i]),o===t.length&&e&&e(t)}}(i))}static createXMLHttpRequest(){return new XMLHttpRequest}static getCSVTool(){return CSVTool}}class HashMap{constructor(){if(this.map=[],this.size_=0,1===arguments.length){for(const t in arguments[0].map)this.map[t]=arguments[0].map[t];this.size_=arguments[0].size_}}each(t){let e=!0;for(const n in this.map){const i=this.map[n];if(!1===t.call(i,n,i)){e=!1;break}}return e}toString(){let t="",e=0;for(const n in this.map)t+=n+"=>"+this.map[n],++e!==this.size_&&(t+="\n");return t}containsKey(t){return void 0!==this.map[t]}containsValue(t){for(const e in this.map)if(this.map[e]===t)return!0;return!1}isEmpty(){return 0===this.size_}clear(){this.map=[],this.size_=0}clone(){const t=new HashMap;for(const e in this.map)t.map[e]=this.map[e];return t.size_=this.size_,t}size(){return this.size_}get(t){return this.map[t]}put(t,e){if(!1===this.containsKey(t))return this.map[t]=e,this.size_=this.size_+1,null;{const n=this.map[t];return this.map[t]=e,n}}putAll(t){for(const e in t.map)void 0===this.map[e]&&(this.map[e]=t.map[e],this.size_=this.size_+1)}remove(t){if(!1===this.containsKey(t))return null;{const e=this.map[t];return delete this.map[t],this.size_=this.size_-1,e}}}class Format{static format(){let t=1;const e=arguments,n=function(t){if(t>=0)return t;{let e=~(t=-t)>>16&65535;const n=65535&~t;return(e*=65536)+n+1}},i=function(i){let o;const s=(o=(i=i.substring(1,i.length)).match(/.$/))[0];if("%"===s)return"%";null!==(o=i.match(/^[0-9]+\$/))&&(o=o[0],i=i.substring(o.length,i.length),o=o.substring(0,o.length-1),t=parseInt(o,10));let h=e[t];t+=1;let r=!1,l=!1,a=!1,u="";null!==(o=i.match(/^[-+ #0]+/))&&(o=o[0],i=i.substring(o.length,i.length),-1!==o.indexOf("#")&&(r=!0),-1!==o.indexOf("-")&&(l=!0),-1!==o.indexOf(" ")&&(u=" "),-1!==o.indexOf("+")&&(u="+"),-1!==o.indexOf("0")&&(a=!0));let c=0;null!==(o=i.match(/^([0-9]+|\*)/))&&(o=o[0],i=i.substring(o.length,i.length),-1!==o.indexOf("*")?(c=h,h=e[t],t+=1):c=parseInt(o,10));let d=!1,g=0;null!==(o=i.match(/^(\.((-?[0-9]+)|\*)|\.)/))&&(o=o[0],i=i.substring(o.length,i.length),d=!0,-1!==o.indexOf("*")?(g=h,h=e[t],t+=1):1===o.length?g=0:(o=o.substring(1,o.length),g=parseInt(o,10))),null!==(o=i.match(/^hh|h|ll|l|L|z|j|t/))&&(i=i.substring(o.length,i.length));let f="",m=!1;switch(s.toLowerCase()){case"d":case"i":case"u":case"b":case"o":case"x":m=!0;case"e":case"f":case"g":{let t,e="",i=0;switch(m?(isNaN(h)&&(h=parseInt(h,10)),"d"===s||"i"===s?(h<0&&(u="-",h=-h),h=Math.floor(h)):h=h>=0?Math.floor(h):Math.ceil(h)):(isNaN(h)&&(h=parseFloat(h)),h<0&&(u="-",h=-h),d||(g=6)),s.toLowerCase()){case"d":case"i":f+=h.toString(10);break;case"u":f+=n(h).toString(10);break;case"b":f+=n(h).toString(2),r&&(e="0b");break;case"o":f+=n(h).toString(8),r&&(e="0");break;case"x":case"X":f+=n(h).toString(16),r&&(e="0x");break;case"e":f+=h.toExponential(g);break;case"f":f+=h.toFixed(g);break;case"g":0===g&&(g=1),f+=h.toPrecision(g),r||-1===f.indexOf(".")||(f=(f=f.replace(/\.?0+$/,"")).replace(/\.?0+e/,"e"))}if(m){if(d){t=g-f.length;for(let e=0;e<t;e++)f="0"+f}}else r&&-1===f.indexOf(".")&&(-1!==f.indexOf("e")?f=f.replace("e",".e"):f+=".");if(-1!==f.indexOf("e")){const t=function(t){const e=t.length;return 3===t.length?t.substring(0,e-1)+"00"+t.substring(e-1,e):t.substring(0,e-2)+"0"+t.substring(e-2,e)};f=f.replace(/e[+-][0-9]{1,2}$/,t)}if(i=f.length+e.length+u.length,t=c-i,l)for(let e=0;e<t;e++)f+=" ";if(a)for(let e=0;e<t;e++)f="0"+f;if(f=e+f,f=u+f,!a&&!l)for(let e=0;e<t;e++)f=" "+f;s.toUpperCase()===s&&(f=f.toUpperCase());break}case"c":isNaN(h)||(h=String.fromCharCode(h));case"s":{isNaN(h)||(h=h.toString(10)),f=h,d&&f.length>g&&(f=f.substring(0,g));const t=f.length,e=c-t;if(l)for(let t=0;t<e;t++)f+=" ";else{const t=a?"0":" ";for(let n=0;n<e;n++)f=t+f}break}case"%":f="%";break;case"p":case"n":f="(変換できません)"}return f};return e[0].replace(/%[^diubBoxXeEfFgGaAcspn%]*[diubBoxXeEfFgGaAcspn%]/g,i)}}const format=Format.format,toStringFromObj=function(t){return"string"==typeof t||t instanceof String?0===t.length?" ":t:void 0===t?typeof t:null===t?"null":"function"==typeof t.toString?t.toString():t instanceof Object?"Object":"null"};class CUIConsole{constructor(){this.output=CUIConsole._getOutput()}static _getOutput(){const t=function(){return"undefined"!=typeof WSH?null:"undefined"!=typeof console?console:"undefined"!=typeof window&&void 0!==window.console?window.console:null};let e=null;if(function(){return"undefined"!=typeof WSH}())e=/cscript\.exe$/i.test(WSH.FullName)?function(t){/\n$/.test(t)?WSH.StdOut.Write(t):WSH.StdOut.Write(t+"\n")}:WScript.Echo;else if(function(){return null!==t()}()){const n=t();e=n.log}else"undefined"!=typeof alert&&(e=alert);return e}getOutput(){return this.output}}class HtmlConsole{constructor(){this.root=null,this.element=null,this.isshow=!1,this.loglength=250,this.linelength=0}_getElement(){if(null!==this.element)return this.element;const t=document.createElement("div");return t.style.backgroundColor="black",t.style.color="white",t.style.display="block",t.style.margin="0px",t.style.padding="5px",t.style.fontFamily="Consolas, Courier New, Courier, Monaco, monospace",t.style.whiteSpace="pre",this.element=t,this.element}_initHTML(){if(null===this.root){let t;if(t=document.getElementById("senko_console")){let e=t.lastChild;for(;e;)t.removeChild(e),e=t.lastChild}else t=document.body;t.style.backgroundColor="black",t.style.margin="0px",t.style.padding="0px",t.style.overflowY="scroll",t.appendChild(this._getElement()),this.root=t}}isShow(){return this.isshow}setShow(t){if("boolean"!=typeof t)throw"not boolean";this._initHTML();const e=this._getElement();this.isshow!==t&&(this.isshow=t,e&&(e.style.display=this.isshow?"block":"none"))}_autoScroll(){if(null!==this.element&&null!==this.root){const t=this.root.clientHeight,e=this.element.clientHeight;e-t-1*t<=this.root.scrollTop&&(this.root.scrollTop=e)}}_addNewLine(){this._initHTML();const t=this._getElement(),e=document.createElement("p");e.innerText="> ",e.style.margin="0.2em 0px 0.2em 0px",e.style.padding="0px",t.appendChild(e),this.linelength++,this._cleaningLog()}_appendText(t){this._initHTML();const e=this._getElement().lastElementChild;e.innerText=e.innerText+t}_cleaningLog(){if(null!==this.element)for(;this.linelength>this.loglength;)this.element.removeChild(this.element.firstElementChild),this.linelength--}setLogLength(t){this.loglength=t}println(t){this._initHTML();const e=this._getElement();e&&(e.lastElementChild||this._addNewLine(),this._appendText(t),this._addNewLine()),this._autoScroll()}}const cui=(new CUIConsole).getOutput();let gui_obj=null,gui=null;(console||window&&window.console)&&(gui_obj=new HtmlConsole,gui=function(t){gui_obj.println(t)});let show_gui=!1,printbuffer="";class Log{static setGUI(){gui&&(show_gui=!0)}static setCUI(){show_gui=!1}static println(t){const e=printbuffer+toStringFromObj(t);printbuffer="",show_gui?gui(e):cui(e)}static print(t){printbuffer+=toStringFromObj(t)}static printf(){const t=[];for(let e=0;e<arguments.length;e++)t.push(arguments[e]);Log.print(format.apply(this,t))}}class Programming{static removeComment(t){let e=!1,n=!1,i=!1,o=!1,s=!1,h=!1;const r=[];for(let l=0;l<t.length;l++){const a=t.charAt(l);if(e)n?n=!1:"\\"===a?n=!0:'"'===a&&(e=!1),r[r.length]=a;else if(s)h&&(h=!1,"/"===a&&(s=!1)),"*"===a?h=!0:"\n"===a&&(r[r.length]=a);else if(o)"\n"===a&&(o=!1,r[r.length]=a);else{if(i){if(i=!1,"/"===a){o=!0,r[r.length-1]="";continue}if("*"===a){s=!0,r[r.length-1]="";continue}}'"'===a&&(e=!0),"/"===a&&(i=!0),r[r.length]=a}}return r.join("")}}class IDSwitch{constructor(){this._initIDSwitch()}_initIDSwitch(){this.istyped=!1,this.ispressed=!1,this.isreleased=!1,this.pressed_time=0}clone(){const t=new IDSwitch;return t.istyped=this.istyped,t.ispressed=this.ispressed,t.isreleased=this.isreleased,t.pressed_time=this.pressed_time,t}keyPressed(){this.ispressed||(this.istyped=!0),this.ispressed=!0,this.pressed_time++}keyReleased(){this.ispressed=!1,this.isreleased=!0,this.pressed_time=0}focusLost(){this.keyReleased()}pickInput(t){if(!(t instanceof IDSwitch))throw"IllegalArgumentException";t.ispressed=this.ispressed,t.istyped=this.istyped,t.isreleased=this.isreleased,t.pressed_time=this.pressed_time,this.isreleased=!1,this.istyped=!1}}class IDPosition{constructor(t,e){this._initIDPosition(t,e)}_initIDPosition(t,e){if(t instanceof IDPosition){const e=t;this.set(e)}else void 0===t?(this.x=0,this.y=0):2===arguments.length?this.set(t,e):(this.x=0,this.y=0)}clone(){return new IDPosition(this)}set(t,e){if(t instanceof IDPosition){const e=t;this.x=e.x,this.y=e.y}else this.x=t,this.y=e}add(t,e){if(t instanceof IDPosition){const e=t;this.x+=e.x,this.y+=e.y}else this.x+=t,this.y+=e}sub(t,e){if(t instanceof IDPosition){const e=t;this.x-=e.x,this.y-=e.y}else this.x-=t,this.y-=e}static norm(t,e){const n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)}}class IDDraggableSwitch{constructor(t){this._initIDDraggableSwitch(t)}_initIDDraggableSwitch(t){this.mask=t,this.switch=new IDSwitch,this.client=new IDPosition,this.deltaBase=new IDPosition,this.dragged=new IDPosition}clone(){const t=new IDDraggableSwitch;return t.mask=this.mask,t.switch=this.switch.clone(),t.client=this.client.clone(),t.deltaBase=this.deltaBase.clone(),t.dragged=this.dragged.clone(),t}correctionForDOM(t){let e=t.target;return e||(e=t.currentTarget),void 0===e?new IDPosition(t.clientX,t.clientY):new IDPosition(t.clientX/e.clientWidth*e.width,t.clientY/e.clientHeight*e.height)}setPosition(t){const e=this.correctionForDOM(t);this.client.set(e),this.deltaBase.set(e),this.dragged._initIDPosition()}mousePressed(t){const e=this.correctionForDOM(t);t.button===this.mask&&(this.switch.ispressed||this.dragged._initIDPosition(),this.switch.keyPressed(),this.client.set(e),this.deltaBase.set(e))}mouseReleased(t){t.button===this.mask&&this.switch.ispressed&&this.switch.keyReleased()}mouseMoved(t){const e=this.correctionForDOM(t);if(this.switch.ispressed){const t=new IDPosition(e);t.sub(this.deltaBase),this.dragged.add(t)}this.client.set(e.x,e.y),this.deltaBase.set(e.x,e.y)}focusLost(){this.switch.focusLost()}pickInput(t){if(!(t instanceof IDDraggableSwitch))throw"IllegalArgumentException";this.switch.pickInput(t.switch),t.client.set(this.client),t.dragged.set(this.dragged),this.dragged._initIDPosition()}}class IDMouse{constructor(){this._initIDMouse()}_initIDMouse(){this.left=new IDDraggableSwitch(IDMouse.MOUSE_EVENTS.BUTTON1_MASK),this.center=new IDDraggableSwitch(IDMouse.MOUSE_EVENTS.BUTTON2_MASK),this.right=new IDDraggableSwitch(IDMouse.MOUSE_EVENTS.BUTTON3_MASK),this.position=new IDPosition,this.wheelrotation=0}clone(){const t=new IDMouse;return t.left=this.left.clone(),t.center=this.center.clone(),t.right=this.right.clone(),t.position=this.position.clone(),t.wheelrotation=this.wheelrotation,t}mousePressed(t){this.left.mousePressed(t),this.center.mousePressed(t),this.right.mousePressed(t)}mouseReleased(t){this.left.mouseReleased(t),this.center.mouseReleased(t),this.right.mouseReleased(t)}mouseMoved(t){this.left.mouseMoved(t),this.center.mouseMoved(t),this.right.mouseMoved(t),this.position.x=this.left.client.x,this.position.y=this.left.client.y}mouseWheelMoved(t){0!==t.wheelDelta&&(this.wheelrotation+=t.deltaY>0?-1:1)}focusLost(){this.left.focusLost(),this.center.focusLost(),this.right.focusLost()}pickInput(t){if(!(t instanceof IDMouse))throw"IllegalArgumentException";this.left.pickInput(t.left),this.center.pickInput(t.center),this.right.pickInput(t.right),t.position.set(this.position),t.wheelrotation=this.wheelrotation,this.wheelrotation=0}setListenerOnElement(t){const e=this,n=function(t){e.mousePressed(t)},i=function(t){e.mouseReleased(t)},o=function(t){e.mouseMoved(t)},s=function(){e.focusLost()},h=function(t){e.mouseWheelMoved(t),t.preventDefault()},r=function(t){t.preventDefault()};t.style.cursor="crosshair",t.style.mozUserSelect="none",t.style.webkitUserSelect="none",t.style.msUserSelect="none",t.style.webkitTouchCallout="none",t.style.webkitTapHighlightColor="rgba(0,0,0,0)",t.addEventListener("mousedown",n,!1),t.addEventListener("mouseup",i,!1),t.addEventListener("mousemove",o,!1),t.addEventListener("mouseout",s,!1),t.addEventListener("wheel",h,!1),t.addEventListener("contextmenu",r,!1)}}IDMouse.MOUSE_EVENTS={BUTTON1_MASK:0,BUTTON2_MASK:1,BUTTON3_MASK:2};class IDTouch extends IDMouse{constructor(){super(),this._initIDTouch()}_initIDTouch(){this.touchcount_to_mask={1:IDMouse.MOUSE_EVENTS.BUTTON1_MASK,2:IDMouse.MOUSE_EVENTS.BUTTON3_MASK,3:IDMouse.MOUSE_EVENTS.BUTTON2_MASK};const t=this;this._mousePressed=function(e){t.mousePressed(e)},this._mouseReleased=function(e){t.mouseReleased(e)},this._mouseMoved=function(e){t.mouseMoved(e)},this.isdoubletouch=!1}_initPosition(t){this.left.setPosition(t),this.right.setPosition(t),this.center.setPosition(t)}_MultiTouchToMouse(t){let e=0,n=0;for(let i=0;i<t.touches.length;i++)e+=t.touches[i].clientX,n+=t.touches[i].clientY;const i={};if(t.touches.length>0){i.clientX=e/t.touches.length,i.clientY=n/t.touches.length,i.button=this.touchcount_to_mask[t.touches.length];const o=t.touches[0];i.target=o.target?o.target:o.currentTarget}else i.clientX=0,i.clientY=0,i.button=0;return i.touchcount=t.touches.length,i}_MoveMultiTouch(t){if(2===t.touches.length){const e=t.touches[0],n=t.touches[1];if(!1===this.isdoubletouch)this.isdoubletouch=!0,this.doubleposition=[],this.doubleposition[0]=new IDPosition(e.clientX,e.clientY),this.doubleposition[1]=new IDPosition(n.clientX,n.clientY);else{const t=new IDPosition(e.clientX,e.clientY),i=new IDPosition(n.clientX,n.clientY),o=IDPosition.norm(this.doubleposition[0],this.doubleposition[1])-IDPosition.norm(t,i);this.doubleposition[0]=t,this.doubleposition[1]=i;const s=Math.abs(o)<10?.01*Math.abs(o):.5;this.wheelrotation+=(o>0?-1:1)*s}}else this.isdoubletouch}_actFuncMask(t,e,n,i){for(const o in IDMouse.MOUSE_EVENTS)t.button=IDMouse.MOUSE_EVENTS[o],IDMouse.MOUSE_EVENTS[o]===i?e(t):n(t)}touchStart(t){const e=this._MultiTouchToMouse(t);this._initPosition(e),this._actFuncMask(e,this._mousePressed,this._mouseReleased,e.button)}touchEnd(t){const e=this._MultiTouchToMouse(t);this._actFuncMask(e,this._mouseReleased,this._mouseReleased,e.button)}touchMove(t){this._MoveMultiTouch(t);const e=this._MultiTouchToMouse(t);this._actFuncMask(e,this._mouseMoved,this._mouseMoved,e.button)}setListenerOnElement(t){super.setListenerOnElement(t);const e=this,n=function(t){e.touchStart(t)},i=function(t){e.touchEnd(t)},o=function(t){e.touchMove(t),t.preventDefault()};t.addEventListener("touchstart",n,!1),t.addEventListener("touchend",i,!1),t.addEventListener("touchmove",o,!1),t.addEventListener("touchcancel",i,!1)}}const IDTools={noScroll:function(){const t=function(){document.body.style.height="100%",document.body.style.overflow="hidden",document.documentElement.height="100%",document.documentElement.overflow="hidden"};window.addEventListener("load",t,!1)}},Device={DraggableSwitch:IDDraggableSwitch,Mouse:IDMouse,Position:IDPosition,Switch:IDSwitch,Touch:IDTouch,Tools:IDTools},BlendFunctions={ipLerp:function(t,e,n){const i=e.subColor(t);return t.addColor(i.mul(n))},brendNone:function(t,e,n){return e},brendAlpha:function(t,e,n){const i=t.getBlendAlpha(),o=e.getBlendAlpha()*n;return(t=BlendFunctions.ipLerp(t,e,o)).setBlendAlpha(Math.max(i,o))},brendAdd:function(t,e,n){const i=t.getBlendAlpha(),o=e.getBlendAlpha()*n;return(t=t.addColor(e.mul(o))).setBlendAlpha(Math.max(i,o))},brendSub:function(t,e,n){const i=t.getBlendAlpha(),o=e.getBlendAlpha()*n;return(t=t.subColor(e.mul(o))).setBlendAlpha(i)},brendRevSub:function(t,e,n){const i=e.getBlendAlpha(),o=t.getBlendAlpha()*n;return(e=e.subColor(t.mul(o))).setBlendAlpha(i)},brendMul:function(t,e,n){const i=t.getBlendAlpha(),o=e.getBlendAlpha()*n;return(t=t.mulColor(e.mul(o).div(255))).setBlendAlpha(i)}};class ImgBlend{constructor(t){this.blendfunc=BlendFunctions.brendNone,1===arguments.length&&this.setBlendMode(t)}clone(){return new ImgBlend(this.blendmode)}setBlendMode(t){this.blendmode=t,t===ImgBlend.MODE.NONE?this.blendfunc=BlendFunctions.brendNone:t===ImgBlend.MODE.ALPHA?this.blendfunc=BlendFunctions.brendAlpha:t===ImgBlend.MODE.ADD?this.blendfunc=BlendFunctions.brendAdd:t===ImgBlend.MODE.SUB?this.blendfunc=BlendFunctions.brendSub:t===ImgBlend.MODE.REVSUB?this.blendfunc=BlendFunctions.brendRevSub:t===ImgBlend.MODE.MUL&&(this.blendfunc=BlendFunctions.brendMul)}blend(t,e,n){return this.blendfunc(t,e,n)}}ImgBlend.MODE={NONE:"NONE",ALPHA:"ALPHA",ADD:"ADD",SUB:"SUB",REVSUB:"REVSUB",MUL:"MUL"};class ImgColor{constructor(){}getColor(){return null}clone(){return null}zero(){return null}one(){return null}add(){return null}sub(){return null}mul(){return null}div(){return null}exp(){return null}log(){return null}pow(){return null}baselog(){return null}table(){return null}random(){return null}luminance(){return null}addColor(){return null}subColor(){return null}mulColor(){return null}divColor(){return null}maxColor(){return null}minColor(){return null}norm(){return null}normFast(){return null}normColor(t,e){return this.subColor(t).norm(e)}normColorFast(t,e){return this.subColor(t).normFast(e)}getBlendAlpha(){return null}setBlendAlpha(){return null}exchangeColorAlpha(){return null}equals(){return!1}searchColor(t,e){let n=0,i=2147483647,o=null,s=2147483646,h=null;for(let r=0;r<t.length;r++)(n=this.normColorFast(t[r],e))<s&&(n<i?(s=i,h=o,i=n,o=t[r]):(s=n,h=t[r]));return{c1:{color:o,norm:i},c2:{color:h,norm:s}}}}ImgColor.NORM_MODE={MANHATTEN:0,EUGRID:1};class ImgWrapInside{constructor(t,e){2===arguments.length?this.setSize(t,e):this.setSize(0,0)}clone(){return new ImgWrapInside(this.width,this.height)}setSize(t,e){this.width=t,this.height=e}getPixelPosition(t,e){return t=~~Math.floor(t),e=~~Math.floor(e),t>=0&&e>=0&&t<this.width&&e<this.height?[t,e]:null}}class ImgWrapClamp extends ImgWrapInside{constructor(t,e){super(t,e)}clone(){return new ImgWrapClamp(this.width,this.height)}getPixelPosition(t,e){return t=~~Math.floor(t),e=~~Math.floor(e),t>=0&&e>=0&&t<this.width&&e<this.height?[t,e]:(t=~~Math.floor(Math.min(Math.max(0,t),this.width-1)),e=~~Math.floor(Math.min(Math.max(0,e),this.height-1)),[t,e])}}class ImgWrapRepeat extends ImgWrapInside{constructor(t,e){super(t,e)}clone(){return new ImgWrapRepeat(this.width,this.height)}getPixelPosition(t,e){if(t=~~Math.floor(t),e=~~Math.floor(e),t>=0&&e>=0&&t<this.width&&e<this.height)return[t,e];const n=Math.floor(t/this.width),i=Math.floor(e/this.height);return t-=Math.floor(this.width*n),e-=Math.floor(this.height*i),t<0&&(t+=this.width),e<0&&(e+=this.height),[t,e]}}class ImgWrap{constructor(t,e,n){this.width=1,this.height=1,arguments.length>=2&&(this.width=e,this.height=n),3==arguments.length?this.setImgWrapMode(t):this.setImgWrapMode(ImgWrap.MODE.INSIDE)}clone(){return new ImgWrap(this.wrapmode,this.width,this.height)}setImgWrapMode(t){this.wrapmode=t,t===ImgWrap.MODE.INSIDE?this.wrap=new ImgWrapInside(this.width,this.height):t===ImgWrap.MODE.CLAMP?this.wrap=new ImgWrapClamp(this.width,this.height):t===ImgWrap.MODE.REPEAT&&(this.wrap=new ImgWrapRepeat(this.width,this.height))}setSize(t,e){this.width=t,this.height=e,this.wrap&&this.wrap.setSize(t,e)}getPixelPosition(t,e){return this.wrap.getPixelPosition(t,e)}}ImgWrap.MODE={INSIDE:"INSIDE",CLAMP:"CLAMP",REPEAT:"REPEAT"};const InterpolationFunctions={ipLerp:function(t,e,n){const i=e.subColor(t);return t.addColor(i.mul(n))},ipCosine:function(t,e,n){return InterpolationFunctions.ipLerp(t,e,.5*(1-Math.cos(Math.PI*n)))},ipHermite2p3:function(t,e,n){return InterpolationFunctions.ipLerp(t,e,n*n*(3-2*n))},ipHermite2p5:function(t,e,n){return InterpolationFunctions.ipLerp(t,e,n*n*n*(6*n*n-15*n+10))},ipHermite4p:function(t,e,n,i,o){const s=i.subColor(n).subColor(t.subColor(e)),h=t.subColor(e).subColor(s),r=n.subColor(t),l=e;return s.mul(o*o*o).addColor(h.mul(o*o)).addColor(r.mul(o)).addColor(l)},funcInBicubic:function(t,e){return t<=1?1-(e+3)*t*t+(e+2)*t*t*t:-4*e+8*e*t-5*e*t*t+e*t*t*t},ipBicubic:function(t,e,n,i,o,s){const h=InterpolationFunctions.funcInBicubic(o+1,s),r=InterpolationFunctions.funcInBicubic(o,s),l=InterpolationFunctions.funcInBicubic(1-o,s),a=InterpolationFunctions.funcInBicubic(2-o,s);return t.mul(h).addColor(e.mul(r)).addColor(n.mul(l)).addColor(i.mul(a)).mul(1/(h+r+l+a))},ipBicubicSoft:function(t,e,n,i,o){return InterpolationFunctions.ipBicubic(t,e,n,i,o,-.5)},ipBicubicNormal:function(t,e,n,i,o){return InterpolationFunctions.ipBicubic(t,e,n,i,o,-1)},ipBicubicSharp:function(t,e,n,i,o){return InterpolationFunctions.ipBicubic(t,e,n,i,o,-1.2)},ipBicubic2D:function(t,e,n,i){let o,s,h,r,l=t[0][0].zero(),a=0;for(s=0;s<4;s++)for(h=InterpolationFunctions.funcInBicubic(Math.abs(-n+s-1),i),o=0;o<4;o++)r=InterpolationFunctions.funcInBicubic(Math.abs(-e+o-1),i),a+=r*=h,l=l.addColor(t[s][o].mul(r));return l=l.mul(1/a)},ipBicubic2DSoft:function(t,e,n){return InterpolationFunctions.ipBicubic2D(t,e,n,-.5)},ipBicubic2DNormal:function(t,e,n){return InterpolationFunctions.ipBicubic2D(t,e,n,-1)},ipBicubic2DSharp:function(t,e,n){return InterpolationFunctions.ipBicubic2D(t,e,n,-1.2)}};class ImgInterpolation{constructor(t){0===arguments.length&&(t=ImgInterpolation.MODE.NEAREST_NEIGHBOR),this.setInterpolationMode(t)}clone(){return new ImgInterpolation(this.ipmode)}setInterpolationMode(t){this.ipmode=t,t===ImgInterpolation.MODE.NEAREST_NEIGHBOR?(this.ipfunc=InterpolationFunctions.ipLerp,this.ipn=1):t===ImgInterpolation.MODE.BILINEAR?(this.ipfunc=InterpolationFunctions.ipLerp,this.ipn=2):t===ImgInterpolation.MODE.COSINE?(this.ipfunc=InterpolationFunctions.ipCosine,this.ipn=2):t===ImgInterpolation.MODE.HERMITE4_3?(this.ipfunc=InterpolationFunctions.ipHermite2p3,this.ipn=2):t===ImgInterpolation.MODE.HERMITE4_5?(this.ipfunc=InterpolationFunctions.ipHermite2p5,this.ipn=2):t===ImgInterpolation.MODE.HERMITE16?(this.ipfunc=InterpolationFunctions.ipHermite4p,this.ipn=4):t===ImgInterpolation.MODE.BICUBIC?(this.ipfunc=InterpolationFunctions.ipBicubic2DNormal,this.ipn=16):t===ImgInterpolation.MODE.BICUBIC_SOFT?(this.ipfunc=InterpolationFunctions.ipBicubicSoft,this.ipn=4):t===ImgInterpolation.MODE.BICUBIC_NORMAL?(this.ipfunc=InterpolationFunctions.ipBicubicNormal,this.ipn=4):t===ImgInterpolation.MODE.BICUBIC_SHARP&&(this.ipfunc=InterpolationFunctions.ipBicubicSharp,this.ipn=4)}getColor(t,e,n){const i=Math.floor(e),o=Math.floor(n);if(1===this.ipn||i===e&&o===n)return t.getPixel(i,o);if(2===this.ipn){const s=e-i,h=n-o;let r,l;r=t.getPixel(i,o),l=t.getPixel(i+1,o);const a=this.ipfunc(r,l,s);r=t.getPixel(i,o+1),l=t.getPixel(i+1,o+1);const u=this.ipfunc(r,l,s);return this.ipfunc(a,u,h)}if(4===this.ipn){const s=e-i,h=n-o;let r,l,a,u;r=t.getPixel(i-1,o-1),l=t.getPixel(i,o-1),a=t.getPixel(i+1,o-1),u=t.getPixel(i+2,o-1);const c=this.ipfunc(r,l,a,u,s);r=t.getPixel(i-1,o),l=t.getPixel(i,o),a=t.getPixel(i+1,o),u=t.getPixel(i+2,o);const d=this.ipfunc(r,l,a,u,s);r=t.getPixel(i-1,o+1),l=t.getPixel(i,o+1),a=t.getPixel(i+1,o+1),u=t.getPixel(i+2,o+1);const g=this.ipfunc(r,l,a,u,s);r=t.getPixel(i-1,o+2),l=t.getPixel(i,o+2),a=t.getPixel(i+1,o+2),u=t.getPixel(i+2,o+2);const f=this.ipfunc(r,l,a,u,s);return this.ipfunc(c,d,g,f,h)}if(16===this.ipn){const s=e-i,h=n-o;let r,l;const a=[];for(l=-1;l<3;l++){const e=[];for(r=-1;r<3;r++)e[e.length]=t.getPixel(i+r,o+l);a[a.length]=e}return this.ipfunc(a,s,h)}return null}}ImgInterpolation.MODE={NEAREST_NEIGHBOR:"NEAREST_NEIGHBOR",BILINEAR:"BILINEAR",COSINE:"COSINE",HERMITE4_3:"HERMITE4_3",HERMITE4_5:"HERMITE4_5",HERMITE16:"HERMITE16",BICUBIC:"BICUBIC",BICUBIC_SOFT:"BICUBIC_SOFT",BICUBIC_NORMAL:"BICUBIC_NORMAL",BICUBIC_SHARP:"BICUBIC_SHARP"};class ImgFIRMatrix{constructor(t){this.height=t.length,this.width=t[0].length,this.matrix=[];let e;for(e=0;e<t.length;e++)this.matrix[e]=t[e].slice()}clone(){return new ImgFIRMatrix(this.matrix)}rotateEdge(t){const e=this.clone(),n=[],i=[];let o,s;for(o=0;o<this.width-1;o++)n.push(e.matrix[0][o]);for(o=0;o<this.height-1;o++)n.push(e.matrix[o][this.width-1]);for(o=this.width-1;o>0;o--)n.push(e.matrix[this.height-1][o]);for(o=this.height-1;o>0;o--)n.push(e.matrix[o][0]);for(o=0;o<n.length;o++)i[o]=n[((o+t)%n.length+n.length)%n.length];for(e.matrix[0]=i.slice(0,this.width),o=0;o<this.height;o++)e.matrix[o][this.width-1]=i[this.width+o];for(e.matrix[this.height-1]=i.slice(this.width+this.height-2,this.width+this.height-2+this.width).reverse(),o=this.height-1,s=0;o>0;o--,s++)e.matrix[o][0]=i[this.width+this.height+this.width-3+s];return e}mul(t){const e=this.clone();let n,i;for(i=0;i<e.height;i++)for(n=0;n<e.width;n++)e.matrix[i][n]*=t;return e}sum(){let t,e,n=0;for(e=0;e<this.height;e++)for(t=0;t<this.width;t++)n+=this.matrix[e][t];return n}normalize(){return this.clone().mul(1/this.sum())}addCenter(t){const e=this.clone();return e.matrix[e.height>>1][e.width>>1]+=t,e}static makeLaplacianFilter(){return new ImgFIRMatrix([[0,-1,0],[-1,4,-1],[0,-1,0]])}static makeSharpenFilter(t){return ImgFIRMatrix.makeLaplacianFilter().mul(t).addCenter(1)}static makeBlur(t,e){const n=[],i=1/(t*e);let o,s;for(s=0;s<e;s++)for(n[s]=[],o=0;o<t;o++)n[s][o]=i;return new ImgFIRMatrix(n)}static makeGaussianFilter(t,e,n){void 0===n&&(n=1);const i=[];let o,s,h;const r=[],l=Math.max(t,e);let a=-Math.floor(l/2);for(o=0;o<l;o++,a++)r[o]=Math.exp(-a*a/(n*n*2));for(h=0;h<e;h++)for(i[h]=[],s=0;s<t;s++)i[h][s]=r[s]*r[h];return new ImgFIRMatrix(i).normalize()}static makeCircle(t){const e=[],n=.5*t,i=t>>1;let o,s;for(s=0;s<t;s++)for(e[s]=[],o=0;o<t;o++)Math.sqrt((i-o)*(i-o)+(i-s)*(i-s))<n?e[s][o]=1:e[s][o]=0;return new ImgFIRMatrix(e).normalize()}}class ImgData{constructor(){if(this.width=1,this.height=1,this.globalAlpha=1,this.data=null,this.blend=new ImgBlend(ImgBlend.MODE.NONE),this.wrap=new ImgWrap(ImgWrap.MODE.INSIDE,this.width,this.height),this.ip=new ImgInterpolation(ImgInterpolation.MODE.NEAREST_NEIGHBOR),1===arguments.length){const t=arguments[0];this.putImageData(t)}else if(2===arguments.length){const t=arguments[0],e=arguments[1];this.setSize(t,e)}}putImageData(t){}setSize(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.wrap.setSize(t,e))}_copyData(t){t.blend=this.blend.clone(),t.wrap=this.wrap.clone(),t.ip=this.ip.clone(),t.setSize(this.width,this.height),t.data.set(this.data),t.globalAlpha=this.globalAlpha}clone(){const t=new ImgData;return this._copyData(t),t}setWrapMode(t){this.wrap.setImgWrapMode(t)}getWrapMode(){return this.wrap.wrapmode}setInterpolationMode(t){this.ip.setInterpolationMode(t)}getInterpolationMode(){return this.ip.ipmode}setBlendType(t){this.blend.setBlendMode(t)}getBlendType(){return this.blend.blendmode}clear(){this.data&&this.data.fill(0)}getPixelInside(t,e){return null}setPixelInside(t,e,n){}getPixel(t,e){const n=this.wrap.getPixelPosition(t,e);return n?this.getPixelInside(n[0],n[1]):this.getPixelInside(0,0).zero()}setPixel(t,e,n){const i=this.wrap.getPixelPosition(t,e);if(i)if(this._blendtype===ImgData.MODE_BLEND.NONE)this.setPixelInside(i[0],i[1],n);else{const t=this.getPixelInside(i[0],i[1]),e=this.blend.blend(t,n,this.globalAlpha);this.setPixelInside(i[0],i[1],e)}}getColor(t,e){return this.ip.getColor(this,t,e)}getColorUV(t,e){return this.getColor(t*this.width,e*this.height)}setColor(t,e,n){this.setPixel(Math.floor(t),Math.floor(e),n)}drawImgData(t,e,n,i,o,s,h,r,l){if(!(t instanceof ImgData))throw"IllegalArgumentException";if(3===arguments.length)s=e,h=n,r=t.width,l=t.height,e=0,n=0,i=t.width,o=t.height;else if(5===arguments.length)s=e,h=n,r=i,l=o,e=0,n=0,i=t.width,o=t.height;else if(9!==arguments.length)throw"IllegalArgumentException";const a=i/r,u=o/l;let c,d,g,f;for(d=n,f=h;f<h+l;f++){for(c=e,g=s;g<s+r;g++){const e=t.getColor(c,d);e&&this.setColor(g,f,e),c+=a}d+=u}}forEach(t){let e=0,n=0;for(;n<this.height;n++)for(e=0;e<this.width;e++)t(this.getPixelInside(e,n),e,n,this)}convolution(t){if(!(t instanceof ImgFIRMatrix))throw"IllegalArgumentException";let e,n,i,o,s,h;const r=-(t.width>>1),l=-(t.height>>1),a=t.matrix,u=this.getPixelInside(0,0).zero(),c=this.clone();for(n=0;n<this.height;n++)for(e=0;e<this.width;e++){let d=u;for(o=n+l,h=0;h<t.height;h++,o++)for(i=e+r,s=0;s<t.width;s++,i++){const t=c.getPixel(i,o);t&&(d=d.addColor(t.mul(a[h][s])))}this.setPixelInside(e,n,d)}}convolutionBilateral(t,e){if(!(t instanceof ImgFIRMatrix))throw"IllegalArgumentException";void 0===e&&(e=.8);let n,i,o,s,h,r;const l=-(t.width>>1),a=-(t.height>>1),u=t.matrix,c=this.getPixelInside(0,0).zero(),d=this.clone(),g=.01*-(1-e)-.001,f=[];for(n=0;n<768;n++)f[n]=Math.exp(n*n*g);for(i=0;i<this.height;i++)for(n=0;n<this.width;n++){const e=d.getPixel(n,i),g=e.getBlendAlpha();let m=0,p=c;const C=[];for(s=i+a,r=0;r<t.height;r++,s++)for(o=n+l,C[r]=[],h=0;h<t.width;h++,o++){const t=d.getPixel(o,s);if(t){const n=f[Math.floor(t.normColor(e,ImgColor.NORM_MODE.EUGRID))]*u[r][h];p=p.addColor(t.mul(n)),m+=n}}p=p.div(m).setBlendAlpha(g),this.setPixelInside(n,i,p)}}convolutionExp(t,e){if(!(t instanceof ImgFIRMatrix))throw"IllegalArgumentException";void 0===e&&(e=1.2);let n,i,o,s,h,r;const l=-(t.width>>1),a=-(t.height>>1),u=t.matrix,c=this.getPixelInside(0,0).zero(),d=this.clone(),g=[];for(n=0;n<256;n++)g[n]=Math.pow(e,n);for(i=0;i<this.height;i++)for(n=0;n<this.width;n++){let f=c;for(s=i+a,r=0;r<t.height;r++,s++)for(o=n+l,h=0;h<t.width;h++,o++){const t=d.getPixel(o,s);t&&(f=f.addColor(t.table(g).mul(u[r][h])))}this.setPixelInside(n,i,f.baselog(e))}}convolutionUnSharp(t,e){if(!(t instanceof ImgFIRMatrix))throw"IllegalArgumentException";let n,i,o,s,h,r;const l=-(t.width>>1),a=-(t.height>>1),u=t.matrix,c=this.getPixelInside(0,0).zero(),d=this.clone();for(i=0;i<this.height;i++)for(n=0;n<this.width;n++){let g=c;for(s=i+a,r=0;r<t.height;r++,s++)for(o=n+l,h=0;h<t.width;h++,o++){const t=d.getPixel(o,s);t&&(g=g.addColor(t.mul(u[r][h])))}const f=d.getPixel(n,i),m=f.subColor(g).mul(e);this.setPixelInside(n,i,f.addColor(m))}}filterSharp(t){const e=ImgFIRMatrix.makeSharpenFilter(t);this.convolution(e)}filterBlur(t){let e;e=ImgFIRMatrix.makeBlur(t,1),this.convolution(e),e=ImgFIRMatrix.makeBlur(1,t),this.convolution(e)}filterGaussian(t){let e;e=ImgFIRMatrix.makeGaussianFilter(t,1),this.convolution(e),e=ImgFIRMatrix.makeGaussianFilter(1,t),this.convolution(e)}filterUnSharp(t,e){const n=ImgFIRMatrix.makeGaussianFilter(t,t);this.convolutionUnSharp(n,e)}filterBilateral(t,e){const n=ImgFIRMatrix.makeGaussianFilter(t,t);this.convolutionBilateral(n,e)}filterSoftLens(t,e){const n=ImgFIRMatrix.makeCircle(t);this.convolutionExp(n,e)}}ImgData.MODE_WRAP=ImgWrap.MODE,ImgData.MODE_IP=ImgInterpolation.MODE,ImgData.MODE_BLEND=ImgBlend.MODE;class ImgColorRGBA extends ImgColor{constructor(t){super(),this.rgba=[t[0],t[1],t[2],t[3]]}get r(){return this.rgba[0]}get g(){return this.rgba[1]}get b(){return this.rgba[2]}get a(){return this.rgba[3]}getColor(){return this.rgba}clone(){return new ImgColorRGBA(this.rgba)}zero(){return new ImgColorRGBA([0,0,0,0])}one(){return new ImgColorRGBA([1,1,1,1])}add(t){return new ImgColorRGBA([this.r+t,this.g+t,this.b+t,this.a+t])}sub(t){return new ImgColorRGBA([this.r-t,this.g-t,this.b-t,this.a-t])}mul(t){return new ImgColorRGBA([this.r*t,this.g*t,this.b*t,this.a*t])}div(t){return new ImgColorRGBA([this.r/t,this.g/t,this.b/t,this.a/t])}exp(){return new ImgColorRGBA([Math.exp(this.r),Math.exp(this.g),Math.exp(this.b),Math.exp(this.a)])}log(){return new ImgColorRGBA([Math.log(this.r),Math.log(this.g),Math.log(this.b),Math.log(this.a)])}pow(t){return new ImgColorRGBA([Math.pow(t,this.r),Math.pow(t,this.g),Math.pow(t,this.b),Math.pow(t,this.a)])}baselog(t){const e=1/Math.log(t);return new ImgColorRGBA([Math.log(this.r)*e,Math.log(this.g)*e,Math.log(this.b)*e,Math.log(this.a)*e])}table(t){return new ImgColorRGBA([t[Math.round(this.r)],t[Math.round(this.g)],t[Math.round(this.b)],t[Math.round(this.a)]])}random(){return new ImgColorRGBA([Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random())])}luminance(){return.2126*this.r+.7152*this.g+.0722*this.b}addColor(t){return new ImgColorRGBA([this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a])}subColor(t){return new ImgColorRGBA([this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a])}mulColor(t){return new ImgColorRGBA([this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a])}divColor(t){return new ImgColorRGBA([this.r/t.r,this.g/t.g,this.b/t.b,this.a/t.a])}maxColor(t){return new ImgColorRGBA([Math.max(t.r,this.r),Math.max(t.g,this.g),Math.max(t.b,this.b),Math.max(t.a,this.a)])}minColor(t){return new ImgColorRGBA([Math.min(t.r,this.r),Math.min(t.g,this.g),Math.min(t.b,this.b),Math.min(t.a,this.a)])}norm(t){return t===ImgColor.NORM_MODE.MANHATTEN?(Math.abs(this.r)+Math.abs(this.g)+Math.abs(this.b))/3:t===ImgColor.NORM_MODE.EUGRID?Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b)/3:void 0}normFast(t){return t===ImgColor.NORM_MODE.MANHATTEN?Math.abs(this.r)+Math.abs(this.g)+Math.abs(this.b):t===ImgColor.NORM_MODE.EUGRID?this.r*this.r+this.g*this.g+this.b*this.b:void 0}getBlendAlpha(){return this.a/255}setBlendAlpha(t){const e=this.clone();return e.rgba[3]=255*t,e}exchangeColorAlpha(t){return new ImgColorRGBA([this.r,this.g,this.b,t.a])}getRRGGBB(){return this.r<<16|this.g<<8|255&this.b}getRed(){return this.r}getGreen(){return this.g}getBlue(){return this.b}equals(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}toString(){return"color("+this.r+","+this.g+","+this.b+","+this.a+")"}mulMatrix(t){const e=new ImgColorRGBA;return e.rgba[0]=this.r*t[0][0]+this.g*t[0][1]+this.b*t[0][2]+this.a*t[0][3],e.rgba[1]=this.r*t[1][0]+this.g*t[1][1]+this.b*t[1][2]+this.a*t[1][3],e.rgba[2]=this.r*t[2][0]+this.g*t[2][1]+this.b*t[2][2]+this.a*t[2][3],e.rgba[3]=this.r*t[3][0]+this.g*t[3][1]+this.b*t[3][2]+this.a*t[3][3],e}}class ImgColorY extends ImgColor{constructor(t){super(),this.y=t}getColor(){return this.y}clone(){return new ImgColorY(this.y)}zero(){return new ImgColorY(0)}one(){return new ImgColorY(1)}add(t){return new ImgColorY(this.y+t)}sub(t){return new ImgColorY(this.y-t)}mul(t){return new ImgColorY(this.y*t)}div(t){return new ImgColorY(this.y/t)}exp(){return new ImgColorY(Math.exp(this.y))}log(){return new ImgColorY(Math.log(this.y))}pow(t){return new ImgColorY(Math.pow(t,this.y))}baselog(t){return new ImgColorY(Math.log(this.y)/Math.log(t))}table(t){return new ImgColorY(t[Math.floor(this.y)])}random(){return new ImgColorY(256*Math.random())}luminance(){return this.y}addColor(t){return new ImgColorY(this.y+t.y)}subColor(t){return new ImgColorY(this.y-t.y)}mulColor(t){return new ImgColorY(this.y*t.y)}divColor(t){return new ImgColorY(this.y/t.y)}maxColor(t){return new ImgColorY(Math.max(t.y,this.y))}minColor(t){return new ImgColorY(Math.min(t.y,this.y))}norm(){return Math.abs(this.y)}normFast(){return Math.abs(this.y)}getBlendAlpha(){return 1}setBlendAlpha(){return this}exchangeColorAlpha(){return this}equals(t){return this.y===t.y}toString(){return"color("+this.y+")"}}class ImgVector{constructor(t,e,n){this.x=t,this.y=e,this.z=n}cross(t){return new ImgVector(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}getDirection(t){return new ImgVector(t.x-this.x,t.y-this.y,t.z-this.z)}normalize(){let t=this.x*this.x+this.y*this.y+this.z*this.z;return t=Math.sqrt(1/t),new ImgVector(this.x*t,this.y*t,this.z*t)}getNormalMapColor(){return new ImgColorRGBA([Math.round(127.5*(1+this.x)),Math.round(127.5*(1-this.y)),Math.round(127.5*(1+this.z)),255])}static createNormalVector(t){if(!(t instanceof ImgColorRGBA))throw"not ImgColorRGBA";return new ImgVector(t.r/128-1,-t.g/128+1,t.b/128-1)}}class ImgDataY extends ImgData{constructor(){1===arguments.length?super(arguments[0]):2===arguments.length?super(arguments[0],arguments[1]):super()}clone(){const t=new ImgDataY(this.width,this.height);return this._copyData(t),t}setSize(t,e){super.setSize(t,e),this.data=new Float32Array(this.width*this.height)}getPixelInside(t,e){const n=e*this.width+t;return new ImgColorY(this.data[n])}setPixelInside(t,e,n){const i=e*this.width+t;this.data[i]=n.getColor()}putImageData(t,e){if(t instanceof ImageData||t instanceof ImgDataRGBA){this.setSize(t.width,t.height),void 0===e&&(e=0);let n=0;for(let i=0;i<this.data.length;i++)this.data[i]=t.data[n+e],n+=4}else{if(!(t instanceof ImgDataY))throw"IllegalArgumentException";this.setSize(t.width,t.height),this.data.set(t.data)}}putImageDataR(t){this.putImageData(t,0)}putImageDataG(t){this.putImageData(t,1)}putImageDataB(t){this.putImageData(t,2)}putImageDataA(t){this.putImageData(t,3)}getImageData(){const t=document.createElement("canvas");t.width=this.width,t.height=this.height;const e=t.getContext("2d").getImageData(0,0,t.width,t.height);let n=0,i=0;for(;i<this.data.length;i++){const t=Math.floor(this.data[i]);e.data[n+0]=t,e.data[n+1]=t,e.data[n+2]=t,e.data[n+3]=255,n+=4}return e}getNormalMap(){if(this.getWrapMode()===ImgData.MODE_WRAP.INSIDE)throw"not inside";const t=new ImgDataRGBA(this.width,this.height);let e,n;for(n=0;n<this.height;n++)for(e=0;e<this.width;e++){const i=new ImgVector(e-1,n,this.getPixel(e-1,n).getColor()),o=new ImgVector(e+1,n,this.getPixel(e+1,n).getColor()),s=i.getDirection(o),h=new ImgVector(e,n-1,this.getPixel(e,n-1).getColor()),r=new ImgVector(e,n+1,this.getPixel(e,n+1).getColor()),l=h.getDirection(r),a=s.cross(l).normalize();t.setPixelInside(e,n,a.getNormalMapColor())}return t}filterEnvironmentMapping(t){}}class ImgDataRGBA extends ImgData{constructor(){1===arguments.length?super(arguments[0]):2===arguments.length?super(arguments[0],arguments[1]):super()}clone(){const t=new ImgDataRGBA(this.width,this.height);return this._copyData(t),t}setSize(t,e){super.setSize(t,e),this.data=new Uint8ClampedArray(this.width*this.height*4)}getPixelInside(t,e){const n=4*(e*this.width+t);return new ImgColorRGBA([this.data[n],this.data[n+1],this.data[n+2],this.data[n+3]])}setPixelInside(t,e,n){const i=4*(e*this.width+t);this.data[i]=n.getColor()[0],this.data[i+1]=n.getColor()[1],this.data[i+2]=n.getColor()[2],this.data[i+3]=n.getColor()[3]}putDataY(t,e){if(!(t instanceof ImgDataY))throw"IllegalArgumentException";this.setSize(t.width,t.height),void 0===e&&(e=0);let n=0,i=0;for(;i<t.data.length;i++)this.data[n+e]=Math.floor(t.data[i]),n+=4}putDataYToR(t){this.putDataS(t,0)}putDataYToG(t){this.putDataS(t,1)}putDataYToB(t){this.putDataS(t,2)}putDataYToA(t){this.putDataS(t,3)}putImageData(t){if(t instanceof ImageData||t instanceof ImgDataRGBA)this.setSize(t.width,t.height),this.data.set(t.data);else{if(!(t instanceof ImgDataY))throw"IllegalArgumentException";this.putImageData(t.getImageData())}}getImageData(){const t=document.createElement("canvas");t.width=this.width,t.height=this.height;const e=t.getContext("2d").getImageData(0,0,t.width,t.height);return e.data.set(this.data),e}grayscale(){this.forEach(function(t,e,n,i){const o=~~t.luminance(),s=new ImgColorRGBA([o,o,o,t.rgba[3]]);i.setPixelInside(e,n,s)})}getColorCount(){const t=new Uint8ClampedArray(2097152);let e=0;return this.forEach(function(n){const i=n.getRRGGBB(),o=i>>3,s=i%7;0==(t[o]>>s&1)&&(e++,t[o]=255&(t[o]^1<<s))}),e}getPalletMedianCut(t){if(this.getColorCount()<=t)return null;let e,n,i,o;const s=new Uint32Array(2097152);let h=0;const r=function(t){return t.getRed()>>1<<14|t.getGreen()>>1<<7|t.getBlue()>>1},l=[],a=[[],[],[]],u=[[],[],[]];for(l[0]=this.width*this.height,e=0;e<3;e++)u[e][h]=0,a[e][h]=127;this.forEach(function(t){s[r(t)]++});let c,d,g,f,m,p,C;for(h++,C=1;h<t;){let t=0,r=0;for(e=0;e<C;e++){const n=(c=a[0][e]-u[0][e])*(d=a[1][e]-u[1][e])*(g=a[2][e]-u[2][e]);t<n&&(t=n,f=c,m=d,p=g,r=e)}let I=m,E=1;if(I<f&&(I=f,E=0),I<p&&(I=p,E=2),0===I)break;{const t=u[E][r]+(I>>1);for(t===a[E][r]?(u[E][C]=t,a[E][C]=a[E][r],a[E][r]=t-1):(u[E][C]=t+1,a[E][C]=a[E][r],a[E][r]=t),e=0;e<3;e++)e!==E&&(u[e][C]=u[e][r],a[e][C]=a[e][r])}for(l[C]=0,n=u[0][C];n<=a[0][C];n++)for(i=u[1][C];i<=a[1][C];i++)for(o=u[2][C];o<=a[2][C];o++)l[C]+=s[n<<14|i<<7|o];if(l[r]-=l[C],0===l[r])for(l[r]=l[C],e=0;e<3;e++)u[e][r]=u[e][C],a[e][r]=a[e][C];else 0===l[C]||(C++,h++)}const I=[];for(e=0;e<h;e++){let t=0,h=0,r=0;for(n=u[0][e];n<=a[0][e];n++)for(i=u[1][e];i<=a[1][e];i++)for(o=u[2][e];o<=a[2][e];o++){const e=s[n<<14|i<<7|o];t+=e*(n<<1),h+=e*(i<<1),r+=e*(o<<1)}n=Math.round(t/l[e]),i=Math.round(h/l[e]),o=Math.round(r/l[e]),n=n<0?0:n>255?255:n,i=i<0?0:i>255?255:i,o=o<0?0:o>255?255:o,I[e]=new ImgColorRGBA([n,i,o,255])}return I}getPallet(){const t=[],e=new Uint32Array(256);let n=0,i=0;return this.forEach(function(o){if(!(n>255)){const s=o.getRRGGBB();for(i=0;i<n;i++)if(e[i]===s)return;e[n]=s,t[n]=o,n++}}),t}getPalletGrayscale(t){const e=t<2?2:t>256?256:t,n=[],i=255/(e-1);let o,s=0;for(o=0;o<e;o++){let t=Math.round(s);t=t<0?0:t>255?255:t,n[o]=new ImgColorRGBA([t,t,t,255]),s+=i}return n}quantizationSimple(t){this.forEach(function(e,n,i,o){const s=e.searchColor(t,ImgColor.NORM_MODE.EUGRID);o.setPixelInside(n,i,s.c1.color.exchangeColorAlpha(e))})}quantizationOrdered(t,e,n){this.forEach(function(i,o,s,h){const r=i.searchColor(t,n),l=r.c1.color,a=r.c1.norm,u=r.c2.color,c=r.c2.norm;let d=a+c;d=0===d?1:d;const g=e.pattern[s%e.height][o%e.width];let f=null;f=l.luminance>u.luminance?g<=Math.floor(c*e.maxnumber/d)?l.exchangeColorAlpha(i):u.exchangeColorAlpha(i):g>=Math.floor(a*e.maxnumber/d)?l.exchangeColorAlpha(i):u.exchangeColorAlpha(i),h.setPixelInside(o,s,f)})}quantizationDiffusion(t,e){const n=this.width*this.height,i=new Int16Array(n),o=new Int16Array(n),s=new Int16Array(n);let h=0;this.forEach(function(t,e,n,r){h=n*r.width+e,i[h]=t.getRed(),o[h]=t.getGreen(),s[h]=t.getBlue()});const r=this.width-e.width+e.center;let l,a,u=0;for(a=0;a<e.height;a++)for(l=0;l<e.width;l++)u+=e.pattern[a][l];const c=[];for(a=0;a<e.height;a++)for(c[a]=[],l=0;l<e.width;l++)c[a][l]=e.pattern[a][l]/u;this.forEach(function(n,u,d,g){h=d*g.width+u;const f=new ImgColorRGBA([i[h],o[h],s[h],255]);let m=f.searchColor(t,ImgColor.NORM_MODE.EUGRID);if(m=m.c1.color,g.setPixelInside(u,d,m.exchangeColorAlpha(n)),!(u>r)){const t=f.subColor(m);for(a=0;a<e.height;a++)for(l=0===a?e.center:0;l<e.width;l++){const n=u+l-e.center,h=d+a;if(!(n<0||h>=g.height)){const e=h*g.width+n;i[e]+=t.getRed()*c[a][l],o[e]+=t.getGreen()*c[a][l],s[e]+=t.getBlue()*c[a][l]}}}})}filterQuantizationSimple(t){if(this.getColorCount()>t){const e=this.getPalletMedianCut(t);this.quantizationSimple(e)}}filterQuantizationOrdered(t,e){if(void 0===e&&(e=ImgColor.NORM_MODE.EUGRID),this.getColorCount()>t){const n=this.getPalletMedianCut(t);this.quantizationOrdered(n,ImgDataRGBA.quantization.orderPattern.patternBayer,e)}}filterQuantizationDiffusion(t,e){if(void 0===e&&(e=ImgDataRGBA.quantization.diffusionPattern.patternFloydSteinberg),this.getColorCount()>t){const n=this.getPalletMedianCut(t);this.quantizationDiffusion(n,e)}}}ImgDataRGBA.quantization={diffusionPattern:{patternFloydSteinberg:{width:3,height:2,center:1,pattern:[[0,0,7],[3,5,1]]},patternJarvisJudiceNinke:{width:5,height:3,center:2,pattern:[[0,0,0,7,5],[3,5,7,5,3],[1,3,5,3,1]]}},orderPattern:{patternBayer:{width:4,height:4,maxnumber:16,pattern:[[0,8,2,10],[12,4,14,6],[3,11,1,9],[15,7,13,5]]}}};const ImageProcessing={ImgDataRGBA:ImgDataRGBA,ImgColorRGBA:ImgColorRGBA,ImgDataY:ImgDataY,ImgColorY:ImgColorY,MODE_WRAP:ImgData.MODE_WRAP,MODE_IP:ImgData.MODE_IP,MODE_BLEND:ImgData.MODE_BLEND};class SBase{constructor(t,e){this.id="SComponent_"+(SBase._counter++).toString(16),this.wallid="SComponent_"+(SBase._counter++).toString(16),this.isshow=!1,this._element=null,this._wall=null,this.elementtype=t,this.unit=SBase.UNIT_TYPE.EM;const n=this,i={over:function(){SBase.node_tool.addClass(n.getElement(),SBase.CLASS_NAME.MOUSEOVER)},out:function(){SBase.node_tool.removeClass(n.getElement(),SBase.CLASS_NAME.MOUSEOVER),SBase.node_tool.removeClass(n.getElement(),SBase.CLASS_NAME.MOUSEDOWN)},down:function(){SBase.node_tool.addClass(n.getElement(),SBase.CLASS_NAME.MOUSEDOWN)},up:function(){SBase.node_tool.removeClass(n.getElement(),SBase.CLASS_NAME.MOUSEDOWN)}};this.tool={attachMouseEvent:function(t){t.addEventListener("touchstart",i.over,!1),t.addEventListener("touchend",i.up,!1),t.addEventListener("mouseover",i.over,!1),t.addEventListener("mouseout",i.out,!1),t.addEventListener("mousedown",i.down,!1),t.addEventListener("mouseup",i.up,!1)},removeNodeForId:function(t){const e=document.getElementById(t);return SBase.node_tool.removeNode(e),e},AputB:function(t,e,n){if(!(t&&e&&e instanceof SBase))throw"IllegalArgumentException";if(t===e)throw"it referenced me";if(n!==SBase.PUT_TYPE.IN&&n!==SBase.PUT_TYPE.RIGHT&&n!==SBase.PUT_TYPE.NEWLINE)throw"IllegalArgumentException";let i=null;if("string"==typeof t||t instanceof String)i=document.getElementById(t);else if(t instanceof SBase)if(n===SBase.PUT_TYPE.IN){if(!t.isContainer())throw"not Container";i=t.getContainerElement()}else i=t.getElement();if(null===i)throw"Not Found "+t;const o=function(t,e){e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t)};if(e.removeMe(),n===SBase.PUT_TYPE.IN)e.onAdded(),null!==i.lastChild&&(e.getWall(SBase.PUT_TYPE.NEWLINE).style.display="block",i.appendChild(e.getWall())),e.getElement().style.display="inline-block",i.appendChild(e.getElement());else{if(null===i.parentNode)throw"not found element on the html";e.onAdded(),o(e.getWall(n),i),o(e.getElement(),e.getWall(n)),n===SBase.PUT_TYPE.RIGHT?(i.style.display="inline-block",e.getWall(n).style.display="inline-block",e.getElement().style.display="inline-block"):n===SBase.PUT_TYPE.NEWLINE&&(i.style.display="inline-block",e.getWall(n).style.display="block",e.getElement().style.display="inline-block")}}},this.setText(e)}getWidth(){let t=this.getElement().style.width;return null===t?null:(t=t.match(/[+-]?\s*[0-9]*\.?[0-9]*/)[0],parseFloat(t))}getHeight(){let t=this.getElement().style.height;return null===t?null:(t=t.match(/[+-]?\s*[0-9]*\.?[0-9]*/)[0],parseFloat(t))}getSize(){return{width:this.getWidth(),height:this.getHeight()}}setWidth(t){if("number"!=typeof t)throw"IllegalArgumentException not number";this.getElement().style.width=t.toString()+this.unit}setHeight(t){if("number"!=typeof t)throw"IllegalArgumentException not number";this.getElement().style.height=t.toString()+this.unit}setSize(t,e){this.setWidth(t),this.setHeight(e)}removeMe(){this.tool.removeNodeForId(this.id),this.tool.removeNodeForId(this.space_id)}onAdded(){}getWall(t){if(this._wall)return this._wall;const e=document.createElement("span");return e.id=this.wallid,t===SBase.PUT_TYPE.RIGHT?e.className=SBase.CLASS_NAME.SPACE:t===SBase.PUT_TYPE.NEWLINE&&(e.className=SBase.CLASS_NAME.NEWLINE),e.style.display="inline-block",this._wall=e,e}isContainer(){return null!==this.getContainerElement()}getContainerElement(){return null}getElement(){if(this._element)return this._element;const t=document.createElement(this.elementtype);return t.id=this.id,t.className=SBase.CLASS_NAME.COMPONENT,t.style.display="inline-block",this._element=t,this.tool.attachMouseEvent(t),t}put(t,e){this.tool.AputB(this,t,e)}putMe(t,e){this.tool.AputB(t,this,e)}isVisible(){return null===this.getElement().style.visibility||"hidden"!==this.getElement().style.visibility}setVisible(t){t?(this.getElement().style.visibility="visible",this.getWall().style.visibility="visible"):(this.getElement().style.visibility="hidden",this.getWall().style.visibility="hidden")}getTextNode(){const t=this.getElement().childNodes;let e=null,n=0;for(n=0;n<t.length;n++)if(t[n]instanceof Text){e=t[n];break}return e}getElementNode(){const t=this.getElement().children;let e=null,n=0;for(n=0;n<t.length;n++)if(!(t[n]instanceof Text)){e=t[n];break}return e}getEditableNodeForValue(){return null}getEditableNodeForNodeValue(){if(this.getEditableNodeForValue())return null;let t=this.getTextNode();if(null===t){const e=this.getElement();t=document.createTextNode(""),e.appendChild(t)}return t}setText(t){if(t){let e=null;return(e=this.getEditableNodeForValue())?void(e.value=t):(e=this.getEditableNodeForNodeValue(),e?void(e.nodeValue=t):void 0)}}getText(){let t=null,e=null;return(e=this.getEditableNodeForValue())&&(t=e.value),(e=this.getEditableNodeForNodeValue())&&(t=e.nodeValue.trim()),null===t?"":t}getEnabledElement(){return null}setEnabled(t){t?SBase.node_tool.removeClass(this.getElement(),SBase.CLASS_NAME.DISABLED):SBase.node_tool.addClass(this.getElement(),SBase.CLASS_NAME.DISABLED);const e=this.getEnabledElement();null!==e&&SBase.node_tool.setBooleanAttribute(e,"disabled",t)}isEnabled(){return!SBase.node_tool.isSetClass(this.getElement(),SBase.CLASS_NAME.DISABLED)}getId(){return this.id}getUnit(){return this.unit}setUnit(t){this.unit=t}addClass(t){return SBase.node_tool.addClass(this.getElement(),t)}toString(){return this._elementtype+"("+this.id+")"}}SBase.PUT_TYPE={IN:0,RIGHT:1,NEWLINE:2},SBase.UNIT_TYPE={PX:"px",EM:"em",PERCENT:"%"},SBase.LABEL_POSITION={LEFT:0,RIGHT:1},SBase.CLASS_NAME={MOUSEOVER:"SCOMPONENT_MouseOver",MOUSEDOWN:"SCOMPONENT_MouseDown",DISABLED:"SCOMPONENT_Disabled",COMPONENT:"SCOMPONENT_Component",NEWLINE:"SCOMPONENT_Newline",CLOSE:"SCOMPONENT_Close",OPEN:"SCOMPONENT_Open",SPACE:"SCOMPONENT_Space",CONTENTSBOX:"SCOMPONENT_ContentsBox",PANEL:"SCOMPONENT_Panel",PANEL_LEGEND:"SCOMPONENT_PanelLegend",SLIDEPANEL:"SCOMPONENT_SlidePanel",SLIDEPANEL_LEGEND:"SCOMPONENT_SlidePanelLegend",SLIDEPANEL_SLIDE:"SCOMPONENT_SlidePanelSlide",GROUPBOX:"SCOMPONENT_GroupBox",GROUPBOX_LEGEND:"SCOMPONENT_GroupBoxLegend",IMAGEPANEL:"SCOMPONENT_ImagePanel",LABEL:"SCOMPONENT_Label",SELECT:"SCOMPONENT_Select",COMBOBOX:"SCOMPONENT_ComboBox",CHECKBOX:"SCOMPONENT_CheckBox",CHECKBOX_IMAGE:"SCOMPONENT_CheckBoxImage",BUTTON:"SCOMPONENT_Button",FILELOAD:"SCOMPONENT_FileLoad",FILESAVE:"SCOMPONENT_FileSave",CANVAS:"SCOMPONENT_Canvas",PROGRESSBAR:"SCOMPONENT_ProgressBar",SLIDER:"SCOMPONENT_Slider",COLORPICKER:"SCOMPONENT_ColorPicker"},SBase._counter=0,SBase.node_tool={setBooleanAttribute:function(t,e,n){if("string"!=typeof e&&!(e instanceof String)||"boolean"!=typeof n)throw"IllegalArgumentException";const i=t.getAttribute(e);n||null!==i?n&&null!==i&&t.removeAttribute(e):t.setAttribute(e,e)},isBooleanAttribute:function(t,e){if("string"!=typeof e&&!(e instanceof String))throw"IllegalArgumentException";return null===t.getAttribute(e)},removeNode:function(t){return t&&t.parentNode&&t.parentNode.removeChild(t),t},removeChildNodes:function(t){let e=t.lastChild;for(;e;)t.removeChild(e),e=t.lastChild},isSetClass:function(t,e){const n=t.className;return null!==n&&new RegExp("(^"+e+"$)|( +"+e+")","g").test(n)},addClass:function(t,e){const n=t.className;if(null===n)return void(t.className=e);new RegExp("(^"+e+"$)|( +"+e+")","g").test(n)||(t.className=n+" "+e)},removeClass:function(t,e){const n=t.className;if(null!==n){const i=new RegExp("(^"+e+"$)|( +"+e+")","g");i.test(n)&&(t.className=n.replace(i,""))}}};class SButton extends SBase{constructor(t){super("input",t),this.addClass(SBase.CLASS_NAME.BUTTON),this.getElement().type="button"}getEditableNodeForValue(){return this.getElement()}getEnabledElement(){return this.getElement()}addListener(t){this.getElement().addEventListener("click",t,!1)}}class SCanvas extends SBase{constructor(){super("canvas"),this.addClass(SBase.CLASS_NAME.CANVAS),this.canvas=super.getElement(),this.glmode=!1,this.setPixelSize(300,150)}getPixelSize(){return{width:this.canvas.width,height:this.canvas.height}}getCanvas(){return this.canvas}setPixelSize(t,e){if(2!==arguments.length||"number"!=typeof t||"number"!=typeof e||t<0||e<0)throw"IllegalArgumentException";t=~~Math.floor(t),e=~~Math.floor(e),this.canvas.width=t,this.canvas.height=e}getContext(){return void 0===this.context&&(this.context=this.canvas.getContext("2d"),null===this.context&&(this.glmode=!0,this.gl=this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl"),this.context=this.gl)),this.context}clear(){this.glmode?this.getContext().clear(this.gl.COLOR_BUFFER_BIT):this.getContext().clearRect(0,0,this.canvas.width,this.canvas.height)}getImageData(){if(!this.glmode)return this.getContext().getImageData(0,0,this.canvas.width,this.canvas.height)}putImageData(t){this.glmode||this.getContext().putImageData(t,0,0)}_putImage(t,e,n){const i=this.canvas;let o=0,s=0,h=i.width,r=i.height;SCanvas.drawtype.ORIGINAL===n?(h=t.width,r=t.height):SCanvas.drawtype.STRETCH===n?(h=i.width,r=i.height):SCanvas.drawtype.FILL_ASPECT_RATIO===n?(h=i.width,r=i.height):(h=t.width,r=t.height,SCanvas.drawtype.ASPECT_RATIO===n&&(h>i.width&&(h=i.width,r=Math.floor(r*(h/t.width))),r>i.height&&(h=Math.floor(h*(i.height/r)),r=i.height)),SCanvas.drawtype.LETTER_BOX===n&&(h=i.width,(r=Math.floor(r*(h/t.width)))>i.height&&(h=Math.floor(h*(i.height/r)),r=i.height),o=Math.floor((i.width-h)/2),s=Math.floor((i.height-r)/2),e=!1)),e&&(this.setUnit(SBase.UNIT_TYPE.PX),this.setSize(h,r),this.setPixelSize(h,r)),this.clear(),t instanceof Image?this.context.drawImage(t,0,0,t.width,t.height,o,s,h,r):t instanceof ImageData&&this.context.putImageData(t,0,0,o,s,h,r)}putImage(t,e,n,i){if(e||(e=null),void 0===n&&(n=SCanvas.drawtype.LETTER_BOX),void 0===i&&(i=!1),t instanceof Image||t instanceof ImageData)this._putImage(t,i,n),"function"==typeof e&&e();else if("string"==typeof t){const o=this,s=new Image;s.onload=function(){o.putImage(s,i,n,e)},s.src=t}else if(t instanceof SCanvas)this.putImage(t.getElement(),i,n,e);else if(t instanceof Element&&"CANVAS"===t.tagName)this.putImage(t.toDataURL(),i,n,e);else{if(!(t instanceof Blob||t instanceof File))throw"IllegalArgumentException";{const o=this,s=new FileReader;s.onload=function(){o.putImage(s.result,i,n,e)},s.readAsDataURL(t)}}}toDataURL(t){return t||(t="image/png"),this.canvas.toDataURL(t)}}SCanvas.drawtype={ORIGINAL:0,ASPECT_RATIO:1,STRETCH:2,LETTER_BOX:3};class SCheckBox extends SBase{constructor(t){super("label"),this.addClass(SBase.CLASS_NAME.LABEL),this.addClass(SBase.CLASS_NAME.CHECKBOX);const e=document.createElement("input");e.type="checkbox",e.id=this.getId()+"_checkbox",e.className=SBase.CLASS_NAME.CHECKBOX_IMAGE,this.checkbox=e,this.textnode=document.createTextNode(t||"");const n=this.getElement();n.appendChild(this.checkbox),n.appendChild(this.textnode)}getEnabledElement(){return this.checkbox}getTextNode(){return this.textnode}getElementNode(){return this.checkbox}setLabelPosition(t){const e=this.getElement(),n=this.getTextNode(),i=this.getElementNode();this.node_tool.removeChildNodes(e),t===SBase.LABEL_POSITION.LEFT?(e.appendChild(n),e.appendChild(i)):(e.appendChild(i),e.appendChild(n))}setCheckBoxImageSize(t){if("number"!=typeof t)throw"IllegalArgumentException not number";this.checkbox.style.height=t.toString()+this.unit,this.checkbox.style.width=t.toString()+this.unit}addListener(t){this.checkbox.addEventListener("change",t,!1)}setChecked(t){this.checkbox.checked=t}isChecked(){return this.checkbox.checked}}class SColorPicker extends SBase{constructor(){super("div"),this.addClass(SBase.CLASS_NAME.COLORPICKER);const t=this.getElement(),e=this,n={H:{div:document.createElement("div"),split:6,value:0,input:null,gauge:null,color_data:[],color_node:[],is_press:!1},S:{div:document.createElement("div"),split:1,value:.5,input:null,gauge:null,color_data:[],color_node:[],is_press:!1},L:{div:document.createElement("div"),split:2,value:.5,input:null,gauge:null,color_data:[],color_node:[],is_press:!1}};for(let t=0;t<=n.H.split;t++){const e=1/n.H.split*t;n.H.color_data.push(Color.newColorNormalizedHSL([e,1,.5]).getCSSHex())}const i=function(t){return function(i){if(i.length&&(i=i[0]),n[t].is_press){let o=i.target;o=o||i.currentTarget,n[t].value=i.offsetX/o.clientWidth,e.redraw()}}},o=function(t,e){return function(o){o.length&&(o=o[0]);let s=o.target;s=s||o.currentTarget,n[t].is_press=e,e&&i(t)(o)}},s=function(t){return function(i){let o=i.target;o=o||i.currentTarget,n[t].value=o.value/100,e.redraw()}},h=function(t,e){const s=document.createElement("div"),h=document.createElement("div"),r=document.createElement("div");t.style.position="relative",s.style.position="absolute",h.style.position="absolute",r.style.position="absolute",s.style.margin="0px",s.style.padding="0px",h.style.margin="0px",h.style.padding="0px",r.style.margin="0px",r.style.padding="0px",s.addEventListener("mousedown",o(e,!0),!1),s.addEventListener("mouseup",o(e,!1),!1),s.addEventListener("mouseout",o(e,!1),!1),s.addEventListener("mousemove",i(e),!1),s.addEventListener("touchstart",o(e,!0),!1),s.addEventListener("touchend",o(e,!1),!1),s.addEventListener("touchcancel",o(e,!1),!1),s.dataset.name=e,s.style.width="100%",s.style.height="100%",s.style.bottom="0px",h.style.width="33%",h.style.height="100%",h.style.bottom="0px",h.style.borderStyle="ridge",h.style.borderWidth="0px 2px 0px 0px",n[e].gauge=h;const l=n[e].split;r.style.width="100%",r.style.height="100%",r.style.overflow="hidden";for(let t=0;t<l;t++){const t=document.createElement("div");t.style.display="inline-block",t.style.margin="0px",t.style.padding="0px",t.style.height="100%",t.style.width=100/l+"%",t.style.background="linear-gradient(to right, #000, #FFF)",n[e].color_node.push(t),r.appendChild(t)}t.appendChild(r),t.appendChild(h),t.appendChild(s)};for(const t in n)!function(t){const e=document.createElement("span"),i=document.createElement("div"),o=document.createElement("input");e.style.display="inline-block",i.style.display="inline-block",o.style.display="inline-block",e.style.verticalAlign="top",i.style.verticalAlign="top",o.style.verticalAlign="top",e.style.height="100%",i.style.height="100%",o.style.height="100%",e.style.margin="0px",e.style.padding="0px",e.style.textAlign="center",i.style.margin="0px 0.5em 0px 0.5em",i.style.padding="0px",i.style.borderStyle="solid",i.style.borderWidth="1px",o.addEventListener("input",s(t),!1),o.type="number",o.style.margin="0px",o.style.padding="0px",o.style.borderStyle="none",o.min=0,o.max=100,o.step=1,n[t].input=o,e.style.width="1.5em",i.style.width="calc(100% - 6.0em)",o.style.width="3.5em",h(i,t);const r=n[t].div;r.style.height="1.2em",r.style.margin="0.5em 0px 0.5em 0px",e.appendChild(document.createTextNode(t)),r.appendChild(e),r.appendChild(i),r.appendChild(o)}(t);this.hls=n,this.listener=[],this.redraw(),t.appendChild(this.hls.H.div),t.appendChild(this.hls.S.div),t.appendChild(this.hls.L.div)}setColor(t){if(!(t instanceof Color))throw"ArithmeticException";const e=this.hls,n=t.getNormalizedHSL();e.H.value=n.h,e.S.value=n.s,e.L.value=n.l,this.redraw()}getColor(){const t=this.hls,e=t.H.value,n=t.S.value,i=t.L.value;return Color.newColorNormalizedHSL([e,n,i])}redraw(){const t=this.hls,e=t.H.value,n=t.S.value,i=t.L.value;t.S.color_data=[Color.newColorNormalizedHSL([e,0,i]).getCSSHex(),Color.newColorNormalizedHSL([e,1,i]).getCSSHex()],t.L.color_data=[Color.newColorNormalizedHSL([e,n,0]).getCSSHex(),Color.newColorNormalizedHSL([e,n,.5]).getCSSHex(),Color.newColorNormalizedHSL([e,n,1]).getCSSHex()];for(const e in t){const n=t[e].color_data,i=t[e].color_node;for(let t=0;t<i.length;t++)i[t].style.background="linear-gradient(to right, "+n[t]+", "+n[t+1]+")";const o=Math.round(100*t[e].value);t[e].gauge.style.width=o+"%",t[e].input.value=o}for(let t=0;t<this.listener.length;t++)this.listener[t]()}addListener(t){this.listener.push(t)}}class SComboBox extends SBase{constructor(t){super("select",t),this.addClass(SBase.CLASS_NAME.SELECT),this.addClass(SBase.CLASS_NAME.COMBOBOX)}getEnabledElement(){return this.getElement()}addListener(t){this.getElement().addEventListener("change",t,!1)}setText(t){if(t){const e=this.getElement();"string"==typeof t&&t instanceof String&&(t=[t]);let n=e.lastChild;for(;n;)e.removeChild(n),n=e.lastChild;let i=0;for(i=0;i<t.length;i++){const n=document.createElement("option");n.text=t[i].toString(),n.value=t[i].toString(),e.appendChild(n)}}}getText(){const t=this.getElement().children;let e=0;const n=[];for(e=0;e<t.length;e++)"OPTION"===t[e].tagName&&(n[n.length]=t[e].text);return n}setSelectedItem(t){const e=this.getElement().children;let n=0,i=0;for(n=0;n<e.length;n++)if("OPTION"===e[n].tagName){if(e[n].value===t.toString()){this.getElement().selectedIndex=i;break}i++}}getSelectedItem(){const t=this.getElement().children,e=this.getElement().selectedIndex;let n=0,i=0;for(n=0;n<t.length;n++)if("OPTION"===t[n].tagName){if(e===i)return t[n].value;i++}return""}}class SFileLoadButton extends SBase{constructor(t){super("label",t),this.addClass(SBase.CLASS_NAME.BUTTON),this.addClass(SBase.CLASS_NAME.FILELOAD);const e=super.getElement(),n=document.createElement("input");e.style.textAlign="center",n.setAttribute("type","file"),n.id=this.getId()+"_file",n.style.display="none",this.file=n,e.appendChild(n)}getEnabledElement(){return this.file}getFileAccept(){const t=this.file.getAttribute("accept");return null===t?"":t}setFileAccept(t){t===SFileLoadButton.FILE_ACCEPT.DEFAULT?null!==this.file.getAttribute("accept")&&this.file.removeAttribute("accept"):this.file.accept=t}addListener(t){this.file.addEventListener("change",function(e){t(e.target.files)},!1)}}SFileLoadButton.FILE_ACCEPT={DEFAULT:"",IMAGE:"image/*",AUDIO:"audio/*",VIDEO:"video/*",TEXT:"text/*",PNG:"image/png",JPEG:"image/jpg",GIF:"image/gif"};class SFileSaveButton extends SBase{constructor(t){super("a",t),this.addClass(SBase.CLASS_NAME.BUTTON),this.addClass(SBase.CLASS_NAME.FILESAVE),this.filename="",this.url="",this.getElement().setAttribute("download",this.filename)}getFileName(){return this.filename}setFileName(t){this.filename=t,this.getElement().setAttribute("download",this.filenam)}setURL(t){this.getElement().href=t,this.url=t}setEnabled(t){this.isEnabled()!==t&&(t?this.getElement().href=this.url:this.getElement().removeAttribute("href")),super.setEnabled(t)}}class SGroupBox extends SBase{constructor(t){super("fieldset"),this.addClass(SBase.CLASS_NAME.GROUPBOX),this.legend=document.createElement("legend"),SBase.node_tool.addClass(this.legend,SBase.CLASS_NAME.GROUPBOX_LEGEND),this.legend.id=this.getId()+"_legend",this.legend.textContent=t,this.body=document.createElement("div"),SBase.node_tool.addClass(this.body,SBase.CLASS_NAME.CONTENTSBOX),this.body.id=this.getId()+"_body";const e=this.getElement();e.appendChild(this.legend),e.appendChild(this.body)}getEnabledElement(){return this.getElement()}getContainerElement(){return this.body}clear(){SBase.node_tool.removeChildNodes(this.body)}}class SImagePanel extends SBase{constructor(){super("div"),this.addClass(SBase.CLASS_NAME.IMAGEPANEL);const t=document.createElement("img");t.id=this.id+"_img",this.image=t,this.getElement().appendChild(this.image)}clear(){this.node_tool.removeChildNodes(this.getElement())}toDataURL(){return this.image.src}putImageData(t){this.putImage(t)}putImage(t,e){if(e||(e=null),"string"==typeof t)this.image.onload=function(){"function"==typeof e&&e()},this.image.src=t;else if(t instanceof ImageData){const n=document.createElement("canvas");n.width=t.width,n.height=t.height;const i=n.getContext("2d");i.putImageData(t,0,0),this.putImage(n,e)}else if(t instanceof Image)this.image.src=t.src;else if(t instanceof SCanvas)this.putImage(t.getElement(),e);else if(t instanceof Element&&"CANVAS"===t.tagName)try{this.putImage(t.toDataURL("image/png"),e)}catch(n){try{this.putImage(t.toDataURL("image/jpeg"),e)}catch(t){}}else{if(!(t instanceof Blob||t instanceof File))throw"IllegalArgumentException";{const n=this,i=new FileReader;i.onload=function(){n.putImage(i.result,e)},i.readAsDataURL(t)}}}}class SLabel extends SBase{constructor(t){super("div",t),this.addClass(SBase.CLASS_NAME.LABEL)}getContainerElement(){return this.getElement()}}class SPanel extends SBase{constructor(t){super("div",null),this.addClass(SBase.CLASS_NAME.PANEL);const e=this.getElement();this.legend=document.createElement("span"),SBase.node_tool.addClass(this.legend,SBase.CLASS_NAME.PANEL_LEGEND),this.legend.id=this.getId()+"_legend",this.body=document.createElement("div"),SBase.node_tool.addClass(this.body,SBase.CLASS_NAME.CONTENTSBOX),this.body.id=this.getId()+"_body";const n=this;this.paneltool={setText:function(t){t?(n.legend.textContent=t,n.legend.style.display="block"):n.legend.style.display="none"}},this.paneltool.setText(t),e.appendChild(this.legend),e.appendChild(this.body)}setText(t){this.paneltool&&this.paneltool.setText(t)}getContainerElement(){return this.body}clear(){SBase.node_tool.removeChildNodes(this.body)}}class SProgressBar extends SBase{constructor(t,e){if(super("label"),this.addClass(SBase.CLASS_NAME.LABEL),this.addClass(SBase.CLASS_NAME.PROGRESSBAR),this.min=0,this.max=0,this.value=t,this.is_indeterminate=!1,0===arguments.length)this.min=0,this.max=1;else{if(2!==arguments.length)throw"IllegalArgumentException";this.min=t,this.max=e}this.progress=document.createElement("progress"),this.getElement().appendChild(this.progress),this.progress.id=this.getId()+"_progress",this.progress.className=SBase.CLASS_NAME.PROGRESSBAR,this.progress.value=0,this.progress.max=1}setMaximum(t){this.max=t}setMinimum(t){this.min=t}getMaximum(){return this.max}getMinimum(){return this.min}setValue(t){this.value=t,this.progress.value=this.getPercentComplete()}getValue(){return this.value}setIndeterminate(t){this.is_indeterminate=t,this.is_indeterminate?this.progress.removeAttribute("value"):this.setValue(this.value)}isIndeterminate(){return this.is_indeterminate}getPercentComplete(){const t=this.max-this.min;return(this.value-this.min)/t}}class SSlidePanel extends SBase{constructor(t){super("div"),this.addClass(SBase.CLASS_NAME.SLIDEPANEL),this.textnode=document.createTextNode(t||""),this.legend=document.createElement("span"),SBase.node_tool.addClass(this.legend,SBase.CLASS_NAME.SLIDEPANEL_LEGEND),this.legend.id=this.getId()+"_legend",this.legend.appendChild(this.textnode),this.slide=document.createElement("div"),SBase.node_tool.addClass(this.slide,SBase.CLASS_NAME.SLIDEPANEL_SLIDE),this.slide.id=this.getId()+"_slide",this.body=document.createElement("div"),SBase.node_tool.addClass(this.body,SBase.CLASS_NAME.CONTENTSBOX),this.body.id=this.getId()+"_body";const e=this,n=function(){e.setOpen(!e.isOpen())};this.legend.addEventListener("click",n),this.setOpen(!1),this.slide.appendChild(this.body);const i=super.getElement();i.appendChild(this.legend),i.appendChild(this.slide)}setOpen(t){this.is_open=t,this.is_open?(this.slide.style.maxHeight=this.body.scrollHeight+"px",SBase.node_tool.addClass(this.legend,SBase.CLASS_NAME.OPEN),SBase.node_tool.removeClass(this.legend,SBase.CLASS_NAME.CLOSE)):(this.slide.style.maxHeight=null,SBase.node_tool.addClass(this.legend,SBase.CLASS_NAME.CLOSE),SBase.node_tool.removeClass(this.legend,SBase.CLASS_NAME.OPEN))}isOpen(){return this.is_open}getTextNode(){return this.textnode}getContainerElement(){return this.body}clear(){SBase.node_tool.removeChildNodes(this.body)}}class SSlider extends SBase{constructor(t,e){if(super("label"),this.addClass(SBase.CLASS_NAME.LABEL),this.addClass(SBase.CLASS_NAME.SLIDER),0===arguments.length)t=0,e=1;else if(2!==arguments.length)throw"IllegalArgumentException";this.slider=document.createElement("input"),this.slider.id=this.getId()+"_slider",this.slider.type="range",this.slider.className=SBase.CLASS_NAME.SLIDER,this.slider.value=t,this.slider.min=t,this.slider.max=e,this.slider.step=(e-t)/100,this.datalist=document.createElement("datalist"),this.datalist.id=this.getId()+"_datalist",this.slider.setAttribute("list",this.datalist.id),this.getElement().appendChild(this.slider),this.getElement().appendChild(this.datalist)}getEnabledElement(){return this.slider}setMaximum(t){this.slider.max=t}setMinimum(t){this.slider.min=t}getMaximum(){return parseFloat(this.slider.max)}getMinimum(){return parseFloat(this.slider.min)}setValue(t){this.slider.value=t}getValue(){return parseFloat(this.slider.value)}setMinorTickSpacing(t){this.slider.step=t}getMinorTickSpacing(){return parseFloat(this.slider.step)}setMajorTickSpacing(t){this.majortick=t,this.removeMajorTickSpacing();let e;const n=this.getMinimum(),i=this.getMaximum();for(e=n;e<=i;e+=t){const t=document.createElement("option");t.value=e.toString(),this.datalist.appendChild(t)}}getMajorTickSpacing(){return this.majortick}removeMajorTickSpacing(){const t=this.datalist;let e=t.lastChild;for(;e;)t.removeChild(e),e=t.lastChild}addListener(t){let e=!1;const n=this,i=function(){e=!0},o=function(){e&&("disabled"!==n.slider.disabled&&t(),e=!1)};this.slider.addEventListener("touchstart",i,!1),this.slider.addEventListener("touchend",o,!1),this.slider.addEventListener("mousedown",i,!1),this.slider.addEventListener("mouseup",o,!1)}getWidth(){let t=this.slider.width;return null===t?null:(t=t.match(/[+-]?\s*[0-9]*\.?[0-9]*/)[0],parseFloat(t))}getHeight(){let t=this.slider.height;return null===t?null:(t=t.match(/[+-]?\s*[0-9]*\.?[0-9]*/)[0],parseFloat(t))}setWidth(t){if("number"!=typeof t)throw"IllegalArgumentException not number";super.setWidth(t),this.slider.style.width=t.toString()+this.unit}setHeight(t){if("number"!=typeof t)throw"IllegalArgumentException not number";super.setHeight(t),this.slider.style.height=t.toString()+this.unit}}const SComponent={Button:SButton,Canvas:SCanvas,CheckBox:SCheckBox,ColorPicker:SColorPicker,ComboBox:SComboBox,FileLoadButton:SFileLoadButton,FileSaveButton:SFileSaveButton,GroupBox:SGroupBox,ImagePanel:SImagePanel,Label:SLabel,Panel:SPanel,ProgressBar:SProgressBar,SlidePanel:SSlidePanel,Slider:SSlider,PUT_TYPE:SBase.PUT_TYPE,UNIT_TYPE:SBase.UNIT_TYPE,LABEL_POSITION:SBase.LABEL_POSITION,FILE_ACCEPT:SFileLoadButton.FILE_ACCEPT},Senko={};Senko._printbuffer="",Senko.ArrayList=ArrayList,Senko.Color=Color,Senko.File=File$1,Senko.HashMap=HashMap,Senko.format=Format.format,Senko.Log=Log,Senko.Programming=Programming,Senko.Device=Device,Senko.ImageProcessing=ImageProcessing,Senko.SComponent=SComponent;export default Senko;
